var earthjs=function(){"use strict";var t=function(){var t=Math.acos,e=Math.asin,n=Math.atan2,o=Math.cos,r=Math.max,a=Math.min,i=Math.PI,s=Math.sin,l=Math.sqrt,c=i/180,u=180/i;function d(t){var e=t[0]/2*c,n=s(e),r=o(e),a=t[1]/2*c,i=s(a),l=o(a),u=t[2]/2*c,d=s(u),h=o(u);return[r*l*h+n*i*d,n*l*h-r*i*d,r*i*h+n*l*d,r*l*d-n*i*h]}function h(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}return d.cartesian=function(t){var e=t[0]*c,n=t[1]*c,r=o(n);return[r*o(e),r*s(e),s(n)]},d.rotation=function(t){return[n(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*u,e(r(-1,a(1,2*(t[0]*t[2]-t[3]*t[1]))))*u,n(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*u]},d.delta=function(e,n){var i=function(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}(e,n),c=l(h(i,i));if(!c)return[1,0,0,0];var u=t(r(-1,a(1,h(e,n))))/2,d=s(u);return[o(u),i[2]/c*d,-i[1]/c*d,i[0]/c*d]},d.multiply=function(t,e){return[t[0]*e[0]-t[1]*e[1]-t[2]*e[2]-t[3]*e[3],t[0]*e[1]+t[1]*e[0]+t[2]*e[3]-t[3]*e[2],t[0]*e[2]-t[1]*e[3]+t[2]*e[0]+t[3]*e[1],t[0]*e[3]+t[1]*e[2]-t[2]*e[1]+t[3]*e[0]]},d}(),e=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};cancelAnimationFrame(e.ticker),n=Object.assign({svgCanvasSelector:".ej-svg,.ej-canvas",selector:"#earth-js",rotate:[130,-33,-11],transparent:!1,map:!1,padding:0,formats:{}},n);var o={onCreate:{},onCreateCall:0,onCreateVals:[],onRefresh:{},onRefreshVals:[],onResize:{},onResizeVals:[],onInterval:{},onIntervalVals:[],onTween:{},onTweenVals:[],ready:null,plugins:[],promeses:[],loadingData:null,recreateSvgOrCanvas:function(t){if(t?l.__plugins().forEach(function(t){t.__on__.onCreate.call(l)}):o.onCreateVals.forEach(function(t){t.call(l)}),0===o.onCreateCall){var e=Object.keys(o.onCreate).map(function(t){return l[t]}).filter(function(t){return t.__name__.match(/^((?!threejs).)*$/i)});o.onCreate={},e.forEach(function(t){return o.onCreate[t.name]=t.__on__.onCreate}),o.onCreateVals=Object.keys(o.onCreate).map(function(t){return o.onCreate[t]})}return o.onCreateCall++,l}};window._=o;var r=d3.selectAll(n.selector),a=+r.attr("width"),i=+r.attr("height");a&&i||(a=n.width||700,i=n.height||500,r.attr("width",a).attr("height",i)),d3.selectAll(n.svgCanvasSelector).attr("width",a).attr("height",i);var s=[a/2,i/2];Object.defineProperty(n,"width",{get:function(){return a},set:function(t){a=t,s[0]=t/2}}),Object.defineProperty(n,"height",{get:function(){return i},set:function(t){i=t,s[1]=t/2}});var l={_:{svg:r,drag:!1,versor:t,center:s,options:n},$slc:{},ready:function(t){if(t){var e=l._.options;if(l._.readyFn=t,l._.promeses=o.promeses,o.promeses.length>0){var n=d3.queue();o.loadingData=!0,o.promeses.forEach(function(t){t.urls.forEach(function(o){var r=void 0,a=o.match(/\.(geojson|json|csv)$/);t.urlType&&!a?r=t.urlType:"geojson"===(r=a[1])&&(r="json"),n.defer(e.formats[r]||d3[r],o)})}),n.await(function(){var e=[].slice.call(arguments),n=e.shift();o.promeses.forEach(function(t){var o=t.urls.length,r=e.slice(0,o),a=l[t.name].ready;r.unshift(n),a?a.apply(l,r):t.onReady.apply(l,r),e=e.slice(o)}),o.loadingData=!1,t.called=!0,t.call(l)})}}else if(0===arguments.length)return o.loadingData},register:function(t,e){var n={name:e||t.name,__name__:t.name,__on__:{}};return o.plugins.push(n),l[n.name]=n,Object.keys(t).forEach(function(e){-1===["urls","onReady","onInit","onTween","onCreate","onResize","onRefresh","onInterval"].indexOf(e)&&"function"==typeof t[e]&&(n[e]=function(){return t[e].apply(l,arguments)})}),t.onInit&&t.onInit.call(l,n),h(t,"onTween",n.name),h(t,"onCreate",n.name),h(t,"onResize",n.name),h(t,"onRefresh",n.name),h(t,"onInterval",n.name),t.urls&&t.onReady&&o.promeses.push({name:n.name,urls:t.urls,urlType:t.urlType,onReady:t.onReady}),l}};Object.defineProperty(l,"loading",{get:function(){return o.loadingData}});var c=[],u=l._;return l.create=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c=t||[],o.recreateSvgOrCanvas(e),c.forEach(function(t){t.create(null)}),c!==[]&&u.ticker(),l},l.$slc.defs=u.svg.append("defs"),u.ticker=function(t){var n=u.interval;t=t||10;var r=void 0,a=0,i=void 0,s=void 0,d=0,h=void 0;return e.ticker=requestAnimationFrame(function u(f){if(f-a>t&&(a=f,!o.loadingData&&(n.call(l,f),f-d>t+30)))for(d=f,s=r=c.length;r;)(i=e[s-r])._.interval.call(i,f),r--;for(s=r=o.onTweenVals.length;r;)(h=o.onTweenVals[s-r])&&h.call(l,f),r--;e.ticker=requestAnimationFrame(u)}),l},u.scale=function(t){return u.proj.scale(t),u.resize(),u.refresh(),l},u.rotate=function(t){return u.proj.rotate(t),u.refresh(),l},u.interval=function(t){for(var e=o.onIntervalVals.length;e--;)o.onIntervalVals[e].call(l,t);return l},u.refresh=function(t){var e=void 0,n=void 0;if(t)(t?o.onRefreshKeys.filter(function(e){return t.test(e)}):o.onRefreshKeys).forEach(function(t){o.onRefresh[t].call(l)});else for(e=n=o.onRefreshVals.length;n;)o.onRefreshVals[e-n].call(l),n--;return l},u.resize=function(){var t,e=void 0;for(t=e=o.onResizeVals.length;e;)o.onResizeVals[t-e].call(l),e--;return l},u.projection=function(){var t=u.options,e=t.scale,n=t.width,o=t.height,r=t.padding;if(u.options.map)return e||(e=n/6.279-r),d3.geoEquirectangular().translate(u.center).precision(.1).scale(e);e||(e=d3.min([n,o])/2-r);var a=u.options.rotate;return"number"==typeof a&&(u.options.rotate=[a,-33,-11]),d3.geoOrthographic().rotate(u.options.rotate).translate(u.center).precision(.1).clipAngle(90).scale(e)},u.proj=u.projection(),u.path=d3.geoPath().projection(u.proj),l.__addEventQueue=function(t,e){var n=l[t].__on__;e?d(n,e,t):n&&Object.keys(n).forEach(function(e){return d(n,e,t)})},l.__removeEventQueue=function(t,e){var n=l[t].__on__;n&&(e?(delete o[e][t],o[e+"Keys"]=Object.keys(o[e]),o[e+"Vals"]=o[e+"Keys"].map(function(t){return o[e][t]})):Object.keys(n).forEach(function(e){delete o[e][t],o[e+"Keys"]=Object.keys(o[e]),o[e+"Vals"]=o[e+"Keys"].map(function(t){return o[e][t]})}))},l.__plugins=function(t){return void 0===t?o.plugins:o.plugins.filter(function(e){return e.__name__.match(t)})},l;function d(t,e,n){o[e][n]=t[e],o[e+"Keys"]=Object.keys(o[e]),o[e+"Vals"]=o[e+"Keys"].map(function(t){return o[e][t]})}function h(t,e,n){t[e]&&(l[n].__on__[e]=t[e],d(t,e,n))}};void 0===window.d3&&(window.d3={}),window.d3.earthjs=e;var n=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)};function o(t,e){(arguments.length<2||isNaN(parseFloat(e))||!isFinite(e)||e<0)&&(e=42),THREE.Geometry.call(this);var n,o=[];for(n=0;n<t.vertices.length;n+=2){var r=t.vertices[n],a=t.vertices[n+1],i=.01745329252*+(90-a),s=.01745329252*+(180-r),l=Math.sin(s)*Math.sin(i)*-1,c=Math.cos(s)*Math.sin(i),u=Math.cos(i),d=.25+r/360,h=.5+a/180;this.vertices.push(new THREE.Vector3(l,u,c)),o.push(new THREE.Vector2(d,h))}var f=this.vertices.length;if(e<=1)for(n=0;n<f;n++){var p=this.vertices[n];this.vertices.push(p.clone().multiplyScalar(e))}for(n=0;n<t.triangles.length;n+=3){var v=t.triangles[n],g=t.triangles[n+1],m=t.triangles[n+2];this.faces.push(new THREE.Face3(v,g,m,[this.vertices[v],this.vertices[g],this.vertices[m]])),this.faceVertexUvs[0].push([o[v],o[g],o[m]]),0<e&&e<=1&&(this.faces.push(new THREE.Face3(f+g,f+v,f+m,[this.vertices[g].clone().multiplyScalar(-1),this.vertices[v].clone().multiplyScalar(-1),this.vertices[m].clone().multiplyScalar(-1)])),this.faceVertexUvs[0].push([o[g],o[v],o[m]]))}if(e<1)for(n=0;n<t.polygons.length;n++)for(var y=t.polygons[n],w=0;w<y.length;w++)for(var C=y[w],j=0;j<C.length;j++){v=C[j],g=C[(j+1)%C.length];var b,E=this.vertices[v],_=this.vertices[g],x=this.vertices[f+v];w<1?(b=_.clone().sub(E).cross(x.clone().sub(E)).normalize(),this.faces.push(new THREE.Face3(v,g,f+v,[b,b,b])),this.faceVertexUvs[0].push([o[v],o[g],o[v]]),e>0&&(this.faces.push(new THREE.Face3(g,f+g,f+v,[b,b,b])),this.faceVertexUvs[0].push([o[g],o[g],o[v]]))):(b=x.clone().sub(E).cross(_.clone().sub(E)).normalize(),this.faces.push(new THREE.Face3(g,v,f+v,[b,b,b])),this.faceVertexUvs[0].push([o[g],o[v],o[v]]),e>0&&(this.faces.push(new THREE.Face3(g,f+v,f+g,[b,b,b])),this.faceVertexUvs[0].push([o[g],o[v],o[g]])))}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,1)}window.THREE&&(o.prototype=Object.create(THREE.Geometry.prototype));return e.plugins={baseCsv:function(){var t={data:[]},e=arguments;return{name:"baseCsv",urls:Array.prototype.slice.call(e),onReady:function(e,n){t.me.data(n)},onInit:function(e){t.me=e},data:function(e){if(!e)return t.data;t.data=e},message:function(e){t.data=t.data.map(e)},allData:function(e){if(!e)return{data:t.data};t.data=e.data},arrToJson:function(e,n){var o={};return t.data.forEach(function(t){return o[t[e]]=t[n]}),o}}},baseGeoJson:function(t){var e={data:null};return{name:"baseGeoJson",urls:t&&[t],onReady:function(t,n){e.me.data(n)},onInit:function(t){e.me=t},data:function(t){if(!t)return e.data;e.data=t},message:function(t){e.data=e.data.map(t)},allData:function(t){if(!t)return{data:e.data};e.data=t.data}}},worldJson:function(t){var e={world:null,land:null,lakes:{type:"FeatureCollection",features:[]},selected:{type:"FeatureCollection",features:[]},countries:{type:"FeatureCollection",features:[]}};return{name:"worldJson",urls:t&&[t],onReady:function(t,n){e.me.data(n)},onInit:function(t){e.me=t},data:function(t){if(!t)return e.world;e.world=t,e.land=topojson.feature(t,t.objects.land),e.countries.features=topojson.feature(t,t.objects.countries).features,t.objects.ne_110m_lakes&&(e.lakes.features=topojson.feature(t,t.objects.ne_110m_lakes).features)},allData:function(t){if(!t)return{world:e.world,land:e.land,lakes:e.lakes,countries:e.countries};e.world=t.world,e.land=t.land,e.lakes=t.lakes,e.countries=t.countries},countries:function(t){if(!t)return e.countries.features;e.countries.features=t}}},world3dJson:function(){var t={data:{},nm_to_id:{},geometries:[]},e=arguments;return{name:"world3dJson",urls:Array.prototype.slice.call(e),onReady:function(e,n,o){t.me.data(n),o&&t.me.arrayOfGeometry(o)},onInit:function(e){t.me=e},data:function(e){if(!e)return t.data;t.data=e},message:function(e){t.data=t.data.map(e)},allData:function(e){if(!e)return{data:t.data,geometries:t.geometries,nm_to_id:t.nm_to_id};t.data=e.data},arrayOfGeometry:function(e){var n=[];for(var o in t.data){var r=t.data[o],a={cid:e[o.toUpperCase()]};r.properties=a,n.push({properties:a,geometry:r})}t.nm_to_id=e,t.geometries={features:n}}}},choroplethCsv:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"schemeReds",o={cid:null,data:null,color:null,oldData:null,selectedColorId:null,selectedCountryId:null,countries:{type:"FeatureCollection",features:[]}};function r(t){var e=this;return t.split(".").forEach(function(t){return e=e[t]}),e}function a(t,e){var n=void 0,o=void 0,r=this;t.split(".").forEach(function(t){n=r,o=t,r=r[t]}),n[o]=e}return{name:"choroplethCsv",urls:t&&[t],onReady:function(t,e){o.me.data(e)},onInit:function(t){o.me=t},data:function(t){if(!t)return o.data;o.data=t,o.oldData=t,o.data.getPath=r,o.data.updatePath=a},filter:function(t){o.data=o.oldData.filter(t)},mergeData:function(t,e){var n=o.data,i=e[0].split(":"),s=e[1].split(":");t.features.forEach(function(t){var e=n.find(function(e){return r.call(t,i[0])===r.call(e,i[1])});if(e){var o=r.call(e,s[1]);a.call(t,s[0],o)}})},colorize:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,a=arguments[2],i=d3[r][9];if(arguments.length>1){var s=o.data.map(function(e){return+e[t]});s=[].concat(n(new Set(s)));var l=[1,8];o.scheme=r,o.minMax=d3.extent(s),o.range=d3.range.apply(d3,l),o.scale=d3.scaleLinear().domain(o.minMax).rangeRound(l),o.color=d3.scaleThreshold().domain(o.range).range(i),o.colorValues=i.map(function(t,e){return{id:e,color:t,value:Math.floor(o.scale.invert(e+1.45)),totalValue:0}}),o.data.forEach(function(e){var n=+e[t],r=o.scale(n);if(void 0===a)e.color=o.color(r);else{var i=d3.color(o.color(r));i.opacity=a,e.color=i+""}e.colorId=r-1,o.colorValues[e.colorId].totalValue+=n})}return o.colorValues},colorScale:function(t){return void 0!==t?o.color(o.scale(+t)):{color:o.color,scale:o.scale,minMax:o.minMax}},setCss:function(t,e){var n=void 0;void 0===e&&null!==o.selectedColorId&&(e=o.selectedColorId);var r=o.data.map(function(t){return n=void 0===e||e===t.colorId||e===t.cid?"opacity:1;fill:"+t.color+";stroke:black":"",".countries path.cid-"+t.cid+" {"+n+";}"});t&&(o.targetCss=t),d3.select(o.targetCss).text(r.join("\n"))},setColorcountries:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".1f",r=o.me.countries(),a=d3.format(n);d3.select(e+" .color-countries").remove();var i=d3.select(e).append("div").attr("class","color-countries");i.append("div").attr("class","color-countries-title");var s=r.filter(function(e){var n=e.properties.value;return o.scale(n)-1===t});s.sort(function(t,e){return e.properties.value-t.properties.value}),i.selectAll("div.color-countries-item").data(s).enter().append("div").attr("data-cid",function(t){return t.properties.cid}).attr("class",function(t){var e=t.properties.cid===o.cid?"selected":"";return"color-countries-item cid-"+t.properties.cid+" "+e}).html(function(t){var e=t.properties,n=e.cid,o=e.name,r=e.value;return o+": "+a(r)+" - "+(n||"&nbsp;-&nbsp;")}),i.on("mouseover",function(){o.me.setCss(o.targetCss,d3.event.target.dataset.cid)}).on("mouseout",function(){o.me.setCss(o.targetCss)})},setColorRange:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"body",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".1f",n=o.me.colorize(),r=d3.format(e);n.sort(function(t,e){return e.value-t.value}),d3.select(t+" .color-range").remove();var a=d3.select(t).append("div").attr("class","color-range");a.append("div").attr("class","color-range-title");var i=n.filter(function(t){return 0!==t.totalValue});o.colorItems=a.selectAll("div.color-range-item").data(i).enter().append("div").attr("class",function(t){return"color-range-item s-"+t.id}).style("background",function(t){return t.color}).text(function(t){return r(t.totalValue)}),o.colorItems.on("click",function(t){o.me.setSelectedColor(t.id)}).on("mouseover",function(t){o.me.setCss(o.targetCss,t.id),o.me.setColorcountries(t.id)}).on("mouseout",function(){o.me.setCss(o.targetCss),null===o.selectedColorId?o.me.setColorcountries(-2):o.me.setColorcountries(o.selectedColorId)})},setSelectedColor:function(t){o.colorItems.classed("selected",!1),o.selectedColorId!==t?o.colorItems.filter(".s-"+t).classed("selected",!0):t=null,o.selectedColorId=t,o.me.setColorcountries(t),o.me.setCss(o.targetCss)},countries:function(t){if(!t)return o.countries.features;o.countries.features=t},cid:function(t){o.cid=t}}},choroplethData:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"json",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"schemeReds",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a={cid:null,data:null,color:null,oldData:null,selectedColorId:null,selectedCountryId:null,countries:{type:"FeatureCollection",features:[]}};function i(t){var e=this;return t.split(".").forEach(function(t){return e=e[t]}),e}function s(t,e){var n=void 0,o=void 0,r=this;t.split(".").forEach(function(t){n=r,o=t,r=r[t]}),n[o]=e}return{name:"choroplethData",urls:t&&[t],urlType:e,onReady:function(t,e){a.me.data(e)},onInit:function(t){a.me=t},data:function(t){if(!t)return a.data;a.data=t,a.oldData=t,a.data.getPath=i,a.data.updatePath=s},filter:function(t){a.data=a.oldData.filter(t)},mergeData:function(t,e){var n=a.data,o=e[0].split(":"),r=e[1].split(":");t.features.forEach(function(t){var e=n.find(function(e){return i.call(t,o[0])===i.call(e,o[1])});if(e){var a=i.call(e,r[1]);s.call(t,r[0],a)}})},colorize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,i=arguments[2],s=d3[e][9];if(arguments.length>1){var l=a.data.map(function(e){return+e[t]});l=[].concat(n(new Set(l)));var c=[1,8];a.scheme=e,a.minMax=r||d3.extent(l),a.range=d3.range.apply(d3,c),a.scale=d3.scaleLinear().domain(a.minMax).rangeRound(c),a.color=d3.scaleThreshold().domain(a.range).range(s),a.colorValues=s.map(function(t,e){return{id:e,color:t,value:Math.floor(a.scale.invert(e+1.45)),totalValue:0}}),a.data.forEach(function(e){var n=+e[t];if(n>=a.minMax[0]&&n<=a.minMax[1]){var o=a.scale(n);if(void 0===i)e.color=a.color(o);else{var r=d3.color(a.color(o));r.opacity=i,e.color=r+""}e.colorId=o-1,a.colorValues[e.colorId].totalValue+=n}})}return a.colorValues},colorScale:function(t){return void 0!==t?a.color(a.scale(+t)):{color:a.color,scale:a.scale,minMax:a.minMax}},setCss:function(t,e){var n=void 0;void 0===e&&null!==a.selectedColorId&&(e=a.selectedColorId);var o=a.data.map(function(t){return n=void 0===e||e===t.colorId||e===t.cid?"opacity:1;fill:"+t.color+";stroke:black":"",".countries path.cid-"+t.cid+" {"+n+";}"});t&&(a.targetCss=t),d3.select(a.targetCss).text(o.join("\n"))},setColorcountries:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".1f",o=a.me.countries(),r=d3.format(n);d3.select(e+" .color-countries").remove();var i=d3.select(e).append("div").attr("class","color-countries");i.append("div").attr("class","color-countries-title");var s=o.filter(function(e){var n=e.properties.value;return a.scale(n)-1===t});s.sort(function(t,e){return e.properties.value-t.properties.value}),i.selectAll("div.color-countries-item").data(s).enter().append("div").attr("data-cid",function(t){return t.properties.cid}).attr("class",function(t){var e=t.properties.cid===a.cid?"selected":"";return"color-countries-item cid-"+t.properties.cid+" "+e}).html(function(t){var e=t.properties,n=e.cid,o=e.name,a=e.value;return o+": "+r(a)+" - "+(n||"&nbsp;-&nbsp;")}),i.on("mouseover",function(){a.me.setCss(a.targetCss,d3.event.target.dataset.cid)}).on("mouseout",function(){a.me.setCss(a.targetCss)})},setColorRange:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"body",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".1f",n=a.me.colorize(),o=d3.format(e);n.sort(function(t,e){return e.value-t.value}),d3.select(t+" .color-range").remove();var r=d3.select(t).append("div").attr("class","color-range");r.append("div").attr("class","color-range-title");var i=n.filter(function(t){return 0!==t.totalValue});a.colorItems=r.selectAll("div.color-range-item").data(i).enter().append("div").attr("class",function(t){return"color-range-item s-"+t.id}).style("background",function(t){return t.color}).text(function(t){return o(t.totalValue)}),a.colorItems.on("click",function(t){a.me.setSelectedColor(t.id)}).on("mouseover",function(t){a.me.setCss(a.targetCss,t.id),a.me.setColorcountries(t.id)}).on("mouseout",function(){a.me.setCss(a.targetCss),null===a.selectedColorId?a.me.setColorcountries(-2):a.me.setColorcountries(a.selectedColorId)})},setSelectedColor:function(t){a.colorItems.classed("selected",!1),a.selectedColorId!==t?a.colorItems.filter(".s-"+t).classed("selected",!0):t=null,a.selectedColorId=t,a.me.setColorcountries(t),a.me.setCss(a.targetCss)},countries:function(t){if(!t)return a.countries.features;a.countries.features=t},cid:function(t){a.cid=t}}},countryNamesCsv:function(t){var e={countryNames:null};return{name:"countryNamesCsv",urls:t&&[t],onReady:function(t,n){e.me.data(n)},onInit:function(t){e.me=t},data:function(t){if(!t)return e.countryNames;e.countryNames=t},mergeData:function(t,n){var o=e.countryNames,r=n[0].split(":"),a=n[1].split(":");t.features.forEach(function(t){var e=o.find(function(e){return""+t[r[0]]===e[r[1]]});e&&(t[a[0]]=e[a[1]])})}}},colorScale:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[d3.rgb("#FFAAFF"),d3.rgb("#FF0000")],n={};return{name:"colorScale",onInit:function(e){n.me=e,n.me.data(t)},data:function(t){n.mnMax=d3.extent(t),n.color=d3.scaleLinear().domain(n.mnMax).interpolate(d3.interpolateHcl).range(e)},color:function(t){return n.color(t)},colors:function(t){return t.map(function(t){return n.color(t)})},colorScale:function(t){for(var e=0,o=[[0,n.me.color(0)]],r=n.mnMax[1]/t,a=0;a<t;a++)e+=r,o.push([e,n.me.color(e)]);return o},colorRange:function(t){if(!t)return e;e=t}}},dotRegion:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.5,n={recreate:!0};function o(t){for(var e=t%256,n=2;n>0;n--)e=(t=Math.floor(t/256))%256+","+e;return e}return{name:"dotRegion",urls:t&&[t],onReady:function(t,e){n.me.data(e)},onInit:function(t){n.me=t,function(){var t=[800,400];n.canvas=d3.select("body").append("canvas").attr("class","ej-hidden").attr("width",1600).attr("height",800).node(),n.context=n.canvas.getContext("2d"),n.proj=d3.geoEquirectangular().translate(t).scale(t[1]/1.2),n.path=d3.geoPath().projection(n.proj).context(n.context)}.call(this)},onCreate:function(){(function(){if(n.recreate){n.recreate=!1,n.context.clearRect(0,0,1024,512);for(var t=n.dataDots.features,r=0;r<t.length;r++){n.context.beginPath();var a=n.proj(t[r].geometry.coordinates);n.context.arc(a[0],a[1],e,0,2*Math.PI),n.context.fillStyle="rgb("+o(r+2)+")",n.context.fill()}}}).call(this)},data:function(t){if(!t)return n.dataDots;n.dataDots=t},detect:function(t){var e,o=n.proj(t);if(o[0]>0){var r=n.context.getImageData(o[0],o[1],1,1).data,a=n.dataDots.features[(e=r.slice(0,3).join(","),e.split(",").reduce(function(t,e){return 256*+t+ +e})-2)];if(a){var i=a.geometry.coordinates;if(Math.floor(i[0])===Math.floor(t[0])&&Math.floor(i[1])===Math.floor(t[1]))return a}}}}},hoverCanvas:function(){var t={svg:null,mouse:null,country:null,ocountry:null,countries:null,hoverHandler:null,onCircle:{},onCircleVals:[],onCountry:{},onCountryVals:[]};function e(){if(this.worldCanvas){var e=this.worldCanvas.data();e&&(t.world=e,t.countries=topojson.feature(e,e.objects.countries))}var n=this._,o=this;t.hoverHandler=function(e,r){var a=this;if(!n.drag&&e){e.sourceEvent&&(e=e.sourceEvent);var i=[e.clientX,e.clientY],s=n.proj.invert(r);t.pos=s,t.dot=null,t.mouse=i,t.country=null,n.options.showDots&&t.onCircleVals.forEach(function(n){t.dot=n.call(a,e,s)}),n.options.showLand&&t.countries&&!t.dot&&(n.drag||(o.countryCanvas?t.country=o.countryCanvas.detectCountry(s):t.country=function(e){return t.countries.features.find(function(t){return t.geometry.coordinates.find(function(t){return d3.polygonContains(t,e)||t.find(function(t){return d3.polygonContains(t,e)})})})}(s),t.ocountry!==t.country&&o.canvasThreejs&&(t.ocountry=t.country,o.canvasThreejs.refresh())),t.onCountryVals.forEach(function(n){n.tooltips?n.call(a,e,t.country):t.ocountry2!==t.country&&n.call(a,e,t.country)}),t.ocountry2=t.country)}},t.svg.on("mousemove",function(){t.hoverHandler.call(this,d3.event,d3.mouse(this))})}return{name:"hoverCanvas",onInit:function(n){t.me=n,t.svg=this._.svg,this._.options.showSelectedCountry=!1,e.call(this)},selectAll:function(n){return n&&(t.q=n,t.svg.on("mousemove",null),t.svg=d3.selectAll(n),e.call(this)),t.svg},onCreate:function(){this.worldJson&&!t.world&&t.me.data(this.worldJson.data())},onCircle:function(e){Object.assign(t.onCircle,e),t.onCircleVals=Object.keys(t.onCircle).map(function(e){return t.onCircle[e]})},onCountry:function(e){Object.assign(t.onCountry,e),t.onCountryVals=Object.keys(t.onCountry).map(function(e){return t.onCountry[e]})},data:function(e){if(!e)return t.world;t.world=e,t.countries=topojson.feature(e,e.objects.countries)},allData:function(e){if(!e)return{world:t.world,countries:t.countries};t.world=e.world,t.countries=e.countries},states:function(){return{pos:t.pos,dot:t.dot,mouse:t.mouse,country:t.country}}}},clickCanvas:function(){var t={mouse:null,country:null,countries:null,onCircle:{},onCircleVals:[],onCountry:{},onCountryVals:[]};function e(){if(this.worldCanvas){var e=this.worldCanvas.data();e&&(t.world=e,t.countries=topojson.feature(e,e.objects.countries))}var n=this._,o=this,r=this.mousePlugin||this.inertiaPlugin;r&&r.onClick({clickCanvas:function(e,r){var a=this;if(e){e.sourceEvent&&(e=e.sourceEvent);var i=[e.clientX,e.clientY],s=n.proj.invert(r);t.pos=s,t.dot=null,t.mouse=i,t.country=null,n.options.showDots&&t.onCircleVals.forEach(function(n){t.dot=n.call(a,e,s)}),n.options.showLand&&!t.dot&&(n.drag||(o.countryCanvas?t.country=o.countryCanvas.detectCountry(s):t.country=function(e){return t.countries.features.find(function(t){return t.geometry.coordinates.find(function(t){return d3.polygonContains(t,e)||t.find(function(t){return d3.polygonContains(t,e)})})})}(s)),t.onCountryVals.forEach(function(n){n.call(a,e,t.country)}))}}}),n.options.showLand=!0}return{name:"clickCanvas",onInit:function(n){t.me=n,e.call(this)},onCreate:function(){this.worldJson&&!t.world&&t.me.data(this.worldJson.data())},onCircle:function(e){Object.assign(t.onCircle,e),t.onCircleVals=Object.keys(t.onCircle).map(function(e){return t.onCircle[e]})},onCountry:function(e){Object.assign(t.onCountry,e),t.onCountryVals=Object.keys(t.onCountry).map(function(e){return t.onCountry[e]})},data:function(e){if(!e)return t.world;t.world=e,t.countries=topojson.feature(e,e.objects.countries)},allData:function(e){if(!e)return{world:t.world,countries:t.countries};t.world=e.world,t.countries=e.countries},state:function(){return{pos:t.pos,dot:t.dot,mouse:t.mouse,country:t.country}}}},mousePlugin:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{zoomScale:[0,5e4]},e=t.zoomScale,n=t.intervalDrag,o={svg:null,wait:null,zoom:null,mouse:null,q:null,sync:[],onDrag:{},onDragVals:[],onDragStart:{},onDragStartVals:[],onDragEnd:{},onDragEndVals:[],onClick:{},onClickVals:[],onDblClick:{},onDblClickVals:[]};function r(){o.onClickVals.forEach(function(t){t.call(o._this,o.event,o.mouse)})}window._mouse=o,void 0===e&&(e=[0,5e4]);var a=void 0,i=void 0,s=void 0;function l(t){var e=t.versor,n=e.cartesian(t.proj.rotate(i).invert(o.mouse)),r=e.multiply(s,e.delta(a,n));o.r=e.rotation(r)}function c(t){var e=this;l(t),t.rotate(o.r),o.onDragVals.forEach(function(t){t.call(e,o.event,o.mouse)})}function u(){var t=this._,u=t.versor,d=t.proj.scale(),h=[t.options.width,t.options.height];o.scale=d3.scaleLinear().domain([30,t.proj.scale()]).range([.1,1]),o.svg.call(d3.drag().on("start",function(){var e=this,n=d3.mouse(this);a=u.cartesian(t.proj.invert(n)),i=t.proj.rotate(),s=u(i),t.drag=null,o.onDragStartVals.forEach(function(t){return t.call(e,o.event,n)}),o.onDragVals.forEach(function(t){return t.call(e,o.event,n)}),t.refresh(),o.mouse=n,o._this=this,o.t1=0,o.t2=0}).on("drag",function(){t.drag=!0,o._this=this,o.mouse=d3.mouse(this),!n&&c(t)}).on("end",function(){var e=this,n=t.drag;t.drag=!1,null===n?(o.event=d3.event,t.options.spin?r():o.wait?(o.wait=null,o.onDblClickVals.forEach(function(t){t.call(o._this,o.event,o.mouse)})):null===o.wait&&(o.wait=setTimeout(function(){o.wait&&(o.wait=!1)},250))):n&&(l(t),t.rotate(o.r),o.onDragVals.forEach(function(t){return t.call(o._this,o.event,o.mouse)}),o.sync.forEach(function(t){return function(t){var e=t[0]-i[0];t[0]=e+this._.proj.rotate()[0],t[0]>=180&&(t[0]-=360),this._.rotate(t)}.call(t,o.r)})),o.onDragEndVals.forEach(function(t){return t.call(e,o.event,o.mouse)}),t.refresh()})),o.zoom=d3.zoom().on("zoom",function(){var n=e,r=d*d3.event.transform.k;r>=n[0]&&r<=n[1]&&(t.scale(r),o.sync.forEach(function(t){return t._.scale(r)}))}).scaleExtent([.1,160]).translateExtent([[0,0],h]).filter(function(){var t=d3.event,e=t.touches;return"wheel"===t.type||e}),o.svg.call(o.zoom)}return{name:"mousePlugin",onInit:function(t){o.me=t,o.oMouse=[],o.svg=this._.svg,u.call(this)},onInterval:function(){(function(){var t=this._;t.drag&&n?o.oMouse[0]!==o.mouse[0]&&o.oMouse[1]!==o.mouse[1]&&(o.oMouse=o.mouse,c(t)):!1===o.wait&&(o.wait=null,r())}).call(this)},selectAll:function(t){return t&&(o.q=t,o.svg.call(d3.drag().on("start",null).on("drag",null).on("end",null)),o.svg.call(d3.zoom().on("zoom",null)),o.svg=d3.selectAll(t),u.call(this),this.hoverCanvas&&this.hoverCanvas.selectAll(t)),o.svg},sync:function(t){o.sync=t},zoom:function(t){o.zoom.scaleTo(o.svg,t?o.scale(t):1)},mouse:function(){return o.mouse},onDrag:function(t){Object.assign(o.onDrag,t),o.onDragVals=Object.keys(o.onDrag).map(function(t){return o.onDrag[t]})},onDragStart:function(t){Object.assign(o.onDragStart,t),o.onDragStartVals=Object.keys(o.onDragStart).map(function(t){return o.onDragStart[t]})},onDragEnd:function(t){Object.assign(o.onDragEnd,t),o.onDragEndVals=Object.keys(o.onDragEnd).map(function(t){return o.onDragEnd[t]})},onClick:function(t){Object.assign(o.onClick,t),o.onClickVals=Object.keys(o.onClick).map(function(t){return o.onClick[t]})},onDblClick:function(t){Object.assign(o.onDblClick,t),o.onDblClickVals=Object.keys(o.onDblClick).map(function(t){return o.onDblClick[t]})}}},canvasPlugin:function(){var t={contexts:[],canvas:null,path:null,q:null},e={};function n(){for(var e=this._.options,n=e.width,o=e.height,r=t.contexts.length;r--;)t.contexts[r].clearRect(0,0,n,o)}return{name:"canvasPlugin",onInit:function(e){t.me=e,function(){var e=this._;e.options.showCanvas=!0,t.path=d3.geoPath().projection(e.proj)}.call(this)},onCreate:function(){(function(){var o=this._;if(o.options.showCanvas){if(!t.canvas){e.g=o.svg.append("g").attr("class",t.me.name);var r=e.g.append("foreignObject").attr("x",0).attr("y",0).attr("width",o.options.width).attr("height",o.options.height).append("xhtml:body").style("margin","0px").style("padding","0px").style("background-color","none").style("width",o.options.width+"px").style("height",o.options.height+"px");t.canvas=r.append("canvas")}t.canvas.attr("x",0).attr("y",0).attr("width",o.options.width).attr("height",o.options.height),t.contexts=t.canvas.nodes().map(function(t){return t.getContext("2d")})}t.canvas&&n.call(this)}).call(this)},onRefresh:function(){n.call(this)},selectAll:function(e){return e&&(t.q=e,t.canvas=d3.selectAll(e)),t.canvas},render:function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=this._;if(r.options.showCanvas){var a=!1,i=r.proj,s=i.rotate(),l=this;t.canvas.each(function(r,c){if(!n||n.indexOf(c)>-1){var u=o[c]||{};u.rotate?(a=!0,i.rotate([s[0]+u.rotate,s[1],s[2]])):a&&(a=!1,i.rotate(s));var d=this.getContext("2d");e.call(l,d,t.path.context(d))}}),a&&(a=!1,i.rotate(s))}},flipRender:function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=this._,a=r.center[0],i=r.proj.rotate();t.me.render(function(t,n){t.save(),t.translate(a,0),t.scale(-1,1),t.translate(-a,0),r.proj.rotate([i[0]+180,-i[1],-i[2]]),e.call(this,t,n),t.restore(),r.proj.rotate(i)},n,o)}}},inertiaPlugin:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{zoomScale:[0,5e4]}).zoomScale,e={sync:[],onDrag:{},onDragVals:[],onDragStart:{},onDragStartVals:[],onDragEnd:{},onDragEndVals:[],onClick:{},onClickVals:[],onDblClick:{},onDblClickVals:[],stalledDrag:0},n=0,o=0,r=[],a=0,i=0,s=0,l=0,c=!1,u=!1,d=void 0;function h(){var t=this;e.this._.drag=!1,e.this._.refresh(),e.onDragEndVals.forEach(function(n){return n.call(t,e.event,e.mouse)})}var f=d3.scaleLinear().domain([65.3,184.5]).range([.6,.25]),p=d3.scaleLinear().domain([65.3,184.5]).range([.55,.2]);function v(){var t=this;if(e.onDragVals.forEach(function(n){return n.call(t,e.event,e.mouse)}),!u)return e.removeEventQueue(e.me.name,"onTween"),void h();a*=.99,i*=.9,c&&(a*=e.dragX,i*=e.dragY),o<-100&&(o=-100,i*=-.95),o>100&&(o=100,i*=-.95);var d=[n+=a,o+=i,r[2]],f=e.sync.length;for(e.rotate(d);f--;)e.sync[f]._.rotate(d);c||s.toPrecision(5)!==n.toPrecision(5)||l.toPrecision(5)!==o.toPrecision(5)||(u=!1),s=n,l=o}function g(){e.event=d3.event,e.mouse=d3.mouse(this);var t=e.event.sourceEvent;if(t){var n=t.touches?t.touches[0]:t;return[n.clientX,-n.clientY]}}var m=void 0,y=void 0;function w(){var t=this;a=0,i=0,c=!0,u=!0,d=null,m=g.call(this),e.onDragStartVals.forEach(function(n){return n.call(t,e.event,e.mouse)}),e.onDragVals.forEach(function(n){return n.call(t,e.event,e.mouse)}),e.removeEventQueue(e.me.name,"onTween"),e.addEventQueue(e.me.name,"onInterval"),e.this._.drag=null}function C(){c=!1,e.removeEventQueue(e.me.name,"onInterval"),d?(d=!1,e.addEventQueue(e.me.name,"onTween")):(h(),e.event=d3.event,null===d&&(e.wait?(clearTimeout(e.wait),e.wait=null,e.onDblClickVals.forEach(function(t){t.call(e._this,e.event,e.mouse)})):e.wait=setTimeout(function(){e.wait=!1,e.onClickVals.forEach(function(t){t.call(e._this,e.event,e.mouse)})},250)))}function j(){var s=this._,l=s.proj.scale(),u=s.options,h=u.width,f=u.height;e.svg.call(d3.zoom().on("start",w).on("zoom",function(){var u=d3.event.sourceEvent,h=u.type,f=u.touches;if("wheel"===h||f&&2===f.length){var p=l*d3.event.transform.k;if(p>=t[0]&&p<=t[1]){var w=e.sync.length;for(s.scale(p);w--;)e.sync[w]._.scale(p)}a=0,i=0}else(function(){c&&(d=!0,y=m,(m=g.call(this))?(r=e.proj.rotate(),n=r[0],o=r[1],a+=m[0]-y[0],i+=m[1]-y[1],v.call(e.this)):m=y,e.this._.drag=!0,e.stalledDrag=0,e._this=this)}).call(this)}).on("end",C).scaleExtent([.1,160]).translateExtent([[0,0],[h,f]]))}return{name:"inertiaPlugin",onInit:function(t){e.me=t,e.this=this,e.svg=this._.svg,j.call(this)},onCreate:function(){(function(){e.proj=this._.proj,e.rotate=this._.rotate,e.addEventQueue=this.__addEventQueue,e.removeEventQueue=this.__removeEventQueue,e.removeEventQueue(e.me.name,"onInterval");var t=e.proj.scale();t=t>200?200:t,e.dragX=f(t),e.dragY=p(t)}).call(this)},onResize:function(){(function(){var t=e.proj.scale();t=t>200?200:t,e.dragX=f(t),e.dragY=p(t)}).call(this)},selectAll:function(t){return t&&(e.q=t,e.svg.call(d3.zoom().on("start",null).on("zoom",null).on("end",null)),e.svg=d3.selectAll(t),j.call(this),this.hoverCanvas&&this.hoverCanvas.selectAll(t)),e.svg},onInterval:function(){d&&e.stalledDrag++>10&&(e.stalledDrag=0,a=0,i=0)},onTween:function(){v.call(this)},sync:function(t){e.sync=t},onDrag:function(t){Object.assign(e.onDrag,t),e.onDragVals=Object.keys(e.onDrag).map(function(t){return e.onDrag[t]})},onDragStart:function(t){Object.assign(e.onDragStart,t),e.onDragStartVals=Object.keys(e.onDragStart).map(function(t){return e.onDragStart[t]})},onDragEnd:function(t){Object.assign(e.onDragEnd,t),e.onDragEndVals=Object.keys(e.onDragEnd).map(function(t){return e.onDragEnd[t]})},stopDrag:function(){u=!1},onClick:function(t){Object.assign(e.onClick,t),e.onClickVals=Object.keys(e.onClick).map(function(t){return e.onClick[t]})},onDblClick:function(t){Object.assign(e.onDblClick,t),e.onDblClickVals=Object.keys(e.onDblClick).map(function(t){return e.onDblClick[t]})}}},countryCanvas:function(t){var e={recreate:!0};return{name:"countryCanvas",urls:t&&[t],onReady:function(t,n){e.me.data(n)},onInit:function(t){e.me=t,function(){e.canvas=d3.select("body").append("canvas").attr("class","ej-hidden").attr("width","1024").attr("height","512").node(),e.context=e.canvas.getContext("2d"),e.proj=d3.geoEquirectangular().precision(.5).translate([512,256]).scale(163),e.path=d3.geoPath().projection(e.proj).context(e.context)}.call(this)},onCreate:function(){this.worldJson&&!e.world&&e.me.data(this.worldJson.data()),function(){if(e.recreate){e.recreate=!1,e.context.clearRect(0,0,1024,512);for(var t=e.countries.features.length;t--;)e.context.beginPath(),e.path(e.countries.features[t]),e.context.fillStyle="rgb("+(t+1)+",0,0)",e.context.fill()}}.call(this)},data:function(t){if(!t)return e.world;e.world=t,e.countries=topojson.feature(t,t.objects.countries)},allData:function(t){if(!t)return{world:e.world,countries:e.countries};e.world=t.world,e.countries=t.countries},detectCountry:function(t){var n=e.proj(t);if(n[0]>0){var o=e.context.getImageData(n[0],n[1],1,1).data;return e.countries.features[o[0]-1]}}}},threejsPlugin:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"three-js",e={renderer:null,scene:null,camera:null},n=new THREE.LoadingManager,o=new THREE.TextureLoader(n),r=void 0;function a(t,e){var n=t[0]*Math.PI/180,o=t[1]*Math.PI/180,r=Math.cos(o);return new THREE.Vector3(e*r*Math.cos(n),e*Math.sin(o),-e*r*Math.sin(n))}function i(t){t||(t=e.group);var n=e.scale(this._.proj.scale());t.scale.x=n,t.scale.y=n,t.scale.z=n,c.call(this)}function s(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this._,a=r.proj.rotate();a[0]-=90;var i=r.versor(a),s=new THREE.Quaternion(-i[2],i[1],i[3],i[0]);(t||e.group).setRotationFromQuaternion(s),c.call(this,n,!1,o)}var l=null;function c(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments[1];n?(e.renderer.render(e.scene,e.camera),l&&(l=null,clearTimeout(l))):null===l&&(l=setTimeout(function(){o&&o.call(t,e.group),e.renderer.render(e.scene,e.camera),l=null},0))}return{name:"threejsPlugin",onInit:function(n){e.me=n,function(){var n=this._;r=n.proj.scale();var o=n.options,a=o.width,i=o.height,s=document.getElementById(t);e.scale=d3.scaleLinear().domain([0,r]).range([0,1]),e.camera=new THREE.OrthographicCamera(-a/2,a/2,i/2,-i/2,.1,3e4),e.light=new THREE.PointLight(16777215,0),e.scene=new THREE.Scene,e.group=new THREE.Group,e.node=s,e.camera.position.z=3010,e.camera.name="camera",e.group.name="group",e.light.name="light",e.scene.add(e.camera),e.scene.add(e.group),e.camera.add(e.light),e.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0,canvas:s}),e.renderer.setClearColor(0,0),e.renderer.setSize(a,i),e.renderer.sortObjects=!0,this.renderThree=c,window.THREEx&&window.THREEx.DomEvents&&(e.domEvents=new window.THREEx.DomEvents(e.camera,e.renderer.domElement)),Object.defineProperty(e.me,"group",{get:function(){return e.group}}),Object.defineProperty(e.me,"camera",{get:function(){return e.camera}}),Object.defineProperty(e.me,"renderer",{get:function(){return e.renderer}}),Object.defineProperty(e.me,"domEvents",{get:function(){return e.domEvents}})}.call(this)},onCreate:function(){e.group.children=[],s.call(this)},onRefresh:function(){s.call(this,null,!0)},onResize:function(){i.call(this)},addGroup:function(t){var n=this;e.group.add(t),t.name&&this[t.name]&&(this[t.name].add=function(){e.group.add(t),n.__addEventQueue(t.name),c.call(n)},this[t.name].remove=function(){e.group.remove(t),n.__removeEventQueue(t.name),c.call(n)},this[t.name].isAdded=function(){return e.group.children.filter(function(e){return e.name===t.name}).length>0})},emptyGroup:function(){for(var t=e.group.children,n=t.length-1;n>-1;--n){var o=t[n];e.group.remove(o),o.name&&this.__removeEventQueue(o.name),c.call(this)}},scale:function(t){i.call(this,t)},rotate:function(t){s.call(this,t)},vertex:function(t){return a(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:r)},wireframe:function(t,e){return function(t,e,n){var o=new THREE.Geometry;return t.coordinates.forEach(function(t){d3.pairs(t.map(function(t){return a(t,n)}),function(t,e){o.vertices.push(t,e)})}),new THREE.LineSegments(o,e)}(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:r)},texture:function(t){var e=this;return o.load(t,function(t){return c.call(e),t})},renderThree:function(){c.call(this)},light:function(){return e.camera.children[0]},node:function(){return e.node},q2rotate:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.group.quaternion,n=[t._w,t._y,-t._x,t._z],o=this._.versor.rotation(n);return o[0]+=90,o},light3d:function(){var t=new THREE.Group,e=new THREE.AmbientLight(7829367),n=new THREE.DirectionalLight(16777215),o=new THREE.DirectionalLight(16777215);return n.position.set(1,0,1),o.position.set(-1,0,1),t.add(e),t.add(n),t.add(o),t}}},dblClickCanvas:function(){var t={mouse:null,country:null,countries:null,onCircle:{},onCircleVals:[],onCountry:{},onCountryVals:[]};function e(){if(this.worldCanvas){var e=this.worldCanvas.data();e&&(t.countries=topojson.feature(e,e.objects.countries))}var n=this._,o=this,r=this.mousePlugin||this.inertiaPlugin;r&&r.onDblClick({dblClickCanvas:function(e,r){var a=this;if(e){e.sourceEvent&&(e=e.sourceEvent);var i=[e.clientX,e.clientY],s=n.proj.invert(r);t.pos=s,t.dot=null,t.mouse=i,t.country=null,n.options.showDots&&t.onCircleVals.forEach(function(n){t.dot=n.call(a,e,s)}),n.options.showLand&&!t.dot&&(n.drag||(o.countryCanvas?t.country=o.countryCanvas.detectCountry(s):t.country=function(e){return t.countries.features.find(function(t){return t.geometry.coordinates.find(function(t){return d3.polygonContains(t,e)||t.find(function(t){return d3.polygonContains(t,e)})})})}(s)),t.onCountryVals.forEach(function(n){n.call(a,e,t.country)}))}}}),n.options.showLand=!0}return{name:"dblClickCanvas",onInit:function(n){t.me=n,e.call(this)},onCreate:function(){this.worldJson&&!t.world&&t.me.data(this.worldJson.data())},onCircle:function(e){Object.assign(t.onCircle,e),t.onCircleVals=Object.keys(t.onCircle).map(function(e){return t.onCircle[e]})},onCountry:function(e){Object.assign(t.onCountry,e),t.onCountryVals=Object.keys(t.onCountry).map(function(e){return t.onCountry[e]})},data:function(e){if(!e)return t.world;t.world=e,t.countries=topojson.feature(e,e.objects.countries)},allData:function(e){if(!e)return{world:t.world,countries:t.countries};t.world=e.world,t.countries=e.countries},state:function(){return{pos:t.pos,dot:t.dot,mouse:t.mouse,country:t.country}}}},autorotatePlugin:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e={lastTick:new Date,degree:t/1e3,sync:[]};var n=0;function o(t){var n=this._.proj.rotate();n[0]+=e.degree*t,this._.rotate(n)}return{name:"autorotatePlugin",onInit:function(t){e.me=t,this._.options.spin=!0},onCreate:function(){(function(){var t=this._.options;this.clickCanvas&&this.clickCanvas.onCountry({autorotatePlugin:function(e,n){n||(t.spin=!t.spin)}})}).call(this)},onInterval:function(t){(function(t){if(t-n>40){n=t;var r=new Date;if(this._.options.spin&&!1===this._.drag){var a=r-e.lastTick;o.call(this,a),e.sync.forEach(function(t){return o.call(t,a)})}e.lastTick=r}}).call(this,t)},speed:function(t){e.degree=t/1e3},sync:function(t){e.sync=t},start:function(){this._.options.spin=!0},stop:function(){this._.options.spin=!1},spin:function(t){if(void 0===t)return this._.options.spin;this._.options.spin=t}}},oceanSvg:function(){var t={svg:null,q:null,scale:0,oceanColor:["rgba(221, 221, 255, 0.6)","rgba(153, 170, 187,0.8)"]},e={};function n(){var n=t.me.name;if(t.svg.selectAll("#ocean,.ocean."+n).remove(),this._.options.showOcean){var r=t.oceanColor;"string"==typeof r&&(r=[r,r]),this.$slc.defs.append("radialGradient").attr("id","ocean").attr("cx","75%").attr("cy","25%").append("stop").attr("offset","100%").attr("stop-color",r[1]),e.ocean=t.svg.append("g").attr("class","ocean "+n).append("circle").attr("cx",this._.center[0]).attr("cy",this._.center[1]).attr("class","noclicks"),o.call(this)}}function o(){e.ocean&&this._.options.showOcean&&e.ocean.attr("r",this._.proj.scale()+t.scale)}return{name:"oceanSvg",onInit:function(e){t.me=e,function(){var e=this._;this._.options.showOcean=!0,Object.defineProperty(e.options,"oceanColor",{get:function(){return t.oceanColor},set:function(e){t.oceanColor=e}}),t.svg=e.svg}.call(this)},onCreate:function(){n.call(this)},onResize:function(){o.call(this)},selectAll:function(e){return e&&(t.q=e,t.svg=d3.selectAll(e)),t.svg},scale:function(e){if(!e)return t.scale;t.scale=e,o.call(this)},recreate:function(){n.call(this)},$ocean:function(){return e.ocean}}},sphereSvg:function(){var t={svg:null,q:null,sphereColor:0},e={};function n(){e.sphere.attr("r",this._.proj.scale())}return{name:"sphereSvg",onInit:function(e){t.me=e,t.svg=this._.svg,this._.options.showSphere=!0},onCreate:function(){(function(){var o=t.me.name;t.svg.selectAll("#glow,.sphere."+o).remove(),this._.options.showSphere&&(this.$slc.defs.nodes()[0].append("\n<filter id='glow'>\n    <feColorMatrix type='matrix'\n        values=\n        '0 0 0 0   0\n         0 0 0 0.9 0\n         0 0 0 0.9 0\n         0 0 0 1   0'/>\n    <feGaussianBlur stdDeviation='5.5' result='coloredBlur'/>\n    <feMerge>\n        <feMergeNode in='coloredBlur'/>\n        <feMergeNode in='SourceGraphic'/>\n    </feMerge>\n</filter>\n"),e.sphere=t.svg.append("g").attr("class","sphere "+o).append("circle").attr("cx",this._.center[0]).attr("cy",this._.center[1]).attr("class","noclicks").attr("filter","url(#glow)"),n.call(this))}).call(this)},onResize:function(){n.call(this)},selectAll:function(e){return e&&(t.q=e,t.svg=d3.selectAll(e)),t.svg},$sphere:function(){return e.sphere}}},zoomPlugin:function(){var t={};return{name:"zoomPlugin",onInit:function(e){t.me=e,function(){var t=this._,e=t.proj.scale(),n=[t.options.width,t.options.height];t.svg.call(d3.zoom().on("zoom start end",function(){var n=d3.event.transform;t.proj.scale(e*n.k),t.resize(),t.refresh()}).scaleExtent([.1,5]).translateExtent([[0,0],n]))}.call(this)}}},fauxGlobeSvg:function(){var t={svg:null,q:null},e={};function n(){(function(){var n=this._,o=t.me.name;if(t.svg.selectAll("#shading,.shading."+o).remove(),n.options.showGlobeShading){var r=this.$slc.defs.append("radialGradient").attr("id","shading").attr("cx","50%").attr("cy","40%");r.append("stop").attr("offset","50%").attr("stop-color","#9ab").attr("stop-opacity","0"),r.append("stop").attr("offset","100%").attr("stop-color","#3e6184").attr("stop-opacity","0.3"),e.globeShading=t.svg.append("g").attr("class","shading "+o).append("circle").attr("cx",n.center[0]).attr("cy",n.center[1]).attr("r",n.proj.scale()).attr("class","noclicks").style("fill","url(#shading)")}}).call(this),function(){var n=this._,o=t.me.name;if(t.svg.selectAll("#hilight,.hilight."+o).remove(),n.options.showGlobeHilight){var r=this.$slc.defs.append("radialGradient").attr("id","hilight").attr("cx","75%").attr("cy","25%");r.append("stop").attr("offset","5%").attr("stop-color","#ffd").attr("stop-opacity","0.6"),r.append("stop").attr("offset","100%").attr("stop-color","#ba9").attr("stop-opacity","0.2"),e.globeHilight=t.svg.append("g").attr("class","hilight "+o).append("circle").attr("cx",n.center[0]).attr("cy",n.center[1]).attr("r",n.proj.scale()).attr("class","noclicks").style("fill","url(#hilight)")}}.call(this)}return{name:"fauxGlobeSvg",onInit:function(e){t.me=e,function(){var e=this._;e.options.showGlobeShading=!0,e.options.showGlobeHilight=!0,t.svg=e.svg}.call(this)},onCreate:function(){n.call(this)},onResize:function(){(function(){var t=this._,n=t.options,o=t.proj.scale();e.globeShading&&n.showGlobeShading&&e.globeShading.attr("r",o),e.globeHilight&&n.showGlobeHilight&&e.globeHilight.attr("r",o)}).call(this)},selectAll:function(e){return e&&(t.q=e,t.svg=d3.selectAll(e)),t.svg},$globeShading:function(){return e.globeShading},$globeHilight:function(){return e.globeHilight}}},graticuleSvg:function(){var t={svg:null,q:null,graticule:d3.geoGraticule()},e={};function n(){var t=this._;e.graticule&&t.options.showGraticule&&(t.options.transparent||t.options.transparentGraticule?(t.proj.clipAngle(180),e.graticule.attr("d",this._.path),t.proj.clipAngle(90)):e.graticule.attr("d",this._.path))}return{name:"graticuleSvg",onInit:function(e){t.me=e,function(){var e=this._;e.options.showGraticule=!0,e.options.transparentGraticule=!1,t.svg=e.svg}.call(this)},onCreate:function(){(function(){var o=t.me.name;t.svg.selectAll(".graticule."+o).remove(),this._.options.showGraticule&&(e.graticule=t.svg.append("g").attr("class","graticule "+o).append("path").datum(t.graticule).attr("class","noclicks"),n.call(this))}).call(this)},onRefresh:function(){n.call(this)},selectAll:function(e){return e&&(t.q=e,t.svg=d3.selectAll(e)),t.svg},$graticule:function(){return e.graticule}}},dropShadowSvg:function(){var t={svg:null,q:null},e={};function n(){var t=this._.proj.scale();e.dropShadow.attr("cy",t+this._.center[1]).attr("rx",.9*t).attr("ry",.25*t)}return{name:"dropShadowSvg",onInit:function(e){t.me=e,function(){var e=this._;e.options.showDropShadow=!0,t.svg=e.svg}.call(this)},onCreate:function(){(function(){var o=this._,r=t.me.name;if(t.svg.selectAll("#drop_shadow,.drop_shadow."+r).remove(),o.options.showDropShadow){var a=this.$slc.defs.append("radialGradient").attr("id","drop_shadow").attr("cx","50%").attr("cy","50%");a.append("stop").attr("offset","20%").attr("stop-color","#000").attr("stop-opacity",".5"),a.append("stop").attr("offset","100%").attr("stop-color","#000").attr("stop-opacity","0"),e.dropShadow=t.svg.append("g").attr("class","drop_shadow "+r).append("ellipse").attr("cx",o.center[0]).attr("class","noclicks").style("fill","url(#drop_shadow)"),n.call(this)}}).call(this)},onResize:function(){e.dropShadow&&this._.options.showDropShadow&&n.call(this)},selectAll:function(e){return e&&(t.q=e,t.svg=d3.selectAll(e)),t.svg},$dropShadow:function(){return e.dropShadow}}},dotTooltipSvg:function(){var t={mouseXY:[0,0],visible:!1},e=d3.select("body").append("div").attr("class","ej-dot-tooltip");function n(){var n=this;this.dotsSvg.$dots().on("mouseover",function(){if(n._.options.showBarTooltip){t.visible=!0,t.mouseXY=[d3.event.pageX+7,d3.event.pageY-15];var r=+this.dataset.index,a=n.dotsSvg.data().features[r];(t.me.show||function(t,e){var n=t.properties,o=Object.keys(n).map(function(t){return t+": "+n[t]}).join("<br/>");return e.html(o)})(a,e).style("display","block").style("opacity",1),o()}}).on("mouseout",function(){t.visible=!1,e.style("opacity",0).style("display","none")}).on("mousemove",function(){n._.options.showBarTooltip&&(t.mouseXY=[d3.event.pageX+7,d3.event.pageY-15],o())})}function o(){e.style("left",t.mouseXY[0]+7+"px").style("top",t.mouseXY[1]-15+"px")}return{name:"dotTooltipSvg",onInit:function(e){t.me=e,this._.options.showBarTooltip=!0},onCreate:function(){n.call(this)},onRefresh:function(){o.call(this)},onResize:function(){(function(){n.call(this),e.style("opacity",0).style("display","none")}).call(this)},visible:function(){return t.visible}}},dotSelectCanvas:function(){var t={dataDots:null,dots:null,radiusPath:null,onHover:{},onHoverVals:[],onClick:{},onClickVals:[],onDblClick:{},onDblClickVals:[]};function e(e){var n=null;if(t.dots){var o=this.hoverCanvas.states().mouse;t.dots.forEach(function(t){o&&!n&&d3.geoDistance(t.coordinates,e)<=.02&&(n=t)})}return n}return{name:"dotSelectCanvas",onInit:function(n){t.me=n,function(){var n=this;if(this.hoverCanvas){var o=function(o,r){var a=e.call(n,r);return t.onHoverVals.forEach(function(t){t.call(n,o,a)}),a};o.tooltips=!0,this.hoverCanvas.onCircle({dotsCanvas:o})}this.clickCanvas&&this.clickCanvas.onCircle({dotsCanvas:function(o,r){var a=e.call(n,r);return t.onClickVals.forEach(function(t){t.call(n,o,a)}),a}}),this.dblClickCanvas&&this.dblClickCanvas.onCircle({dotsCanvas:function(o,r){var a=e(o);return t.onDblClickVals.forEach(function(t){t.call(n,o,a)}),a}})}.call(this)},onCreate:function(){this.dotsCanvas&&!t.dots&&t.me.dots(this.dotsCanvas.dots())},onHover:function(e){Object.assign(t.onHover,e),t.onHoverVals=Object.keys(t.onHover).map(function(e){return t.onHover[e]})},onClick:function(e){Object.assign(t.onClick,e),t.onClickVals=Object.keys(t.onClick).map(function(e){return t.onClick[e]})},onDblClick:function(e){Object.assign(t.onDblClick,e),t.onDblClickVals=Object.keys(t.onDblClick).map(function(e){return t.onDblClick[e]})},dots:function(e){t.dots=e}}},graticuleCanvas:function(){var t=d3.geoGraticule()(),e={style:{},drawTo:null};function n(){var n=this._;n.options.showGraticule&&((n.options.transparent||n.options.transparentGraticule)&&n.proj.clipAngle(180),this.canvasPlugin.render(function(n,o){n.beginPath(),o(t),n.lineWidth=e.style.lineWidth||.4,n.strokeStyle=e.style.line||"rgba(119,119,119,0.6)",n.stroke()},e.drawTo),(n.options.transparent||n.options.transparentGraticule)&&n.proj.clipAngle(90))}return{name:"graticuleCanvas",onInit:function(t){e.me=t,function(){var t=this._;t.options.showGraticule=!0,t.options.transparentGraticule=!1}.call(this)},onCreate:function(){n.call(this)},onRefresh:function(){n.call(this)},drawTo:function(t){e.drawTo=t},style:function(t){return t&&(e.style=t),e.style}}},dotTooltipCanvas:function(){var t={hidden:null},e=d3.select("body").append("div").attr("class","ej-dot-tooltip");function n(n,o){var r=[n.clientX,n.clientY];(t.me.show||function(t,e){var n=t.properties,o=Object.keys(n).map(function(t){return t+": "+n[t]}).join("<br/>");return e.html(o)})(o,e).style("display","block").style("opacity",1).style("left",r[0]+7+"px").style("top",r[1]-15+"px"),t.oldData=o,t.hidden=!1}function o(){var o=this;this.dotSelectCanvas.onHover({dotTooltipCanvas:function(r,a){a&&null!==o._.drag?n(r,a):t.hidden||(t.hidden=!0,e.style("opacity",0).style("display","none"))}})}return{name:"dotTooltipCanvas",onInit:function(e){t.me=e,o.call(this)}}},countrySelectCanvas:function(){var t={countries:null,onHover:{},onHoverVals:[],onClick:{},onClickVals:[],onDblClick:{},onDblClickVals:[]};return{name:"countrySelectCanvas",onInit:function(e){t.me=e,function(){var e=this;this.hoverCanvas&&this.hoverCanvas.onCountry({countrySelectCanvas:function(n,o){return t.onHoverVals.forEach(function(t){t.call(e,n,o)}),o}}),this.clickCanvas&&this.clickCanvas.onCountry({countrySelectCanvas:function(n,o){return t.onClickVals.forEach(function(t){t.call(e,n,o)}),o}}),this.dblClickCanvas&&this.dblClickCanvas.onCountry({countrySelectCanvas:function(n,o){return t.onDblClickVals.forEach(function(t){t.call(e,n,o)}),o}})}.call(this)},onCreate:function(){(function(){if(this.worldCanvas&&!t.countries){var e=this.worldCanvas.data();e&&(t.world=e,t.countries=topojson.feature(e,e.objects.countries))}}).call(this)},onHover:function(e){Object.assign(t.onHover,e),t.onHoverVals=Object.keys(t.onHover).map(function(e){return t.onHover[e]})},onClick:function(e){Object.assign(t.onClick,e),t.onClickVals=Object.keys(t.onClick).map(function(e){return t.onClick[e]})},onDblClick:function(e){Object.assign(t.onDblClick,e),t.onDblClickVals=Object.keys(t.onDblClick).map(function(e){return t.onDblClick[e]})},data:function(e){if(!e)return t.world;t.world=e,t.countries=topojson.feature(e,e.objects.countries)}}},countryTooltipCanvas:function(t){var e={hidden:null},n=d3.select("body").append("div").attr("class","ej-country-tooltip");function o(t){return n.style("left",t[0]+7+"px").style("top",t[1]-15+"px")}function r(t,r){o([t.clientX,t.clientY]),(e.me.show||function(t,e){var n=Object.keys(t).map(function(e){return e+": "+t[e]}).join("<br/>");return e.html(n)})(r,n).style("display","block").style("opacity",1),e.hidden=!1}function a(){e.hidden||(e.hidden=!0,n.style("opacity",0).style("display","none"))}function i(){var t=this,n=function(n,o){if(e.mouse=[n.clientX,n.clientY],null!==t._.drag&&o&&t._.options.showCountryTooltip){var i=(s=o,l="",e.countryNames&&(l=e.countryNames.find(function(t){return t.id==s.id})),l);!i||t.barTooltipSvg&&t.barTooltipSvg.visible()?a():r(n,i)}else a();var s,l};n.tooltips=!0,this.hoverCanvas.onCountry({countryTooltipCanvas:n}),this._.options.showCountryTooltip=!0}return{name:"countryTooltipCanvas",urls:t&&[t],onReady:function(t,n){e.countryNames=n},onInit:function(t){e.me=t,i.call(this)},onRefresh:function(){this._.drag&&o.call(this,e.mouse)},data:function(t){if(!t)return e.countryNames;e.countryNames=t}}},countryTooltipSvg:function(t){var e={show:!1},n=d3.select("body").append("div").attr("class","ej-country-tooltip");function o(){var t=this;this.worldSvg.$countries().on("mouseover",function(o){if(t._.options.showCountryTooltip){e.show=!0;var a=function(t){var n="";return e.countryNames&&(n=e.countryNames.find(function(e){return e.id==t.id})),n}(o);r(),(e.me.show||function(t,e){var n=Object.keys(t).map(function(e){return e+": "+t[e]}).join("<br/>");return e.html(n)})(a,n).style("display","block").style("opacity",1)}}).on("mouseout",function(){e.show=!1,n.style("opacity",0).style("display","none")}).on("mousemove",function(){e.mouse=d3.mouse(this),t._.options.showCountryTooltip&&r()})}function r(t){return t||(t=[d3.event.pageX,d3.event.pageY]),n.style("left",t[0]+7+"px").style("top",t[1]-15+"px")}return{name:"countryTooltipSvg",urls:t&&[t],onReady:function(t,n){e.countryNames=n},onInit:function(t){e.me=t,this._.options.showCountryTooltip=!0},onCreate:function(){o.call(this)},onRefresh:function(){this._.drag&&e.show&&r.call(this,e.mouse)},data:function(t){if(!t)return e.countryNames;e.countryNames=t}}},barTooltipSvg:function(){var t={mouseXY:[0,0],visible:!1},e=d3.select("body").append("div").attr("class","ej-bar-tooltip");function n(){var n=this;this.barSvg.$bar().on("mouseover",function(){if(n._.options.showBarTooltip){t.visible=!0,t.mouseXY=[d3.event.pageX+7,d3.event.pageY-15];var r=+this.dataset.index,a=n.barSvg.data().features[r];(t.me.show||function(t,e){var n=t.properties,o=Object.keys(n).map(function(t){return t+": "+n[t]}).join("<br/>");return e.html(o)})(a,e).style("display","block").style("opacity",1),o()}}).on("mouseout",function(){t.visible=!1,e.style("opacity",0).style("display","none")}).on("mousemove",function(){n._.options.showBarTooltip&&(t.mouseXY=[d3.event.pageX+7,d3.event.pageY-15],o())})}function o(){e.style("left",t.mouseXY[0]+7+"px").style("top",t.mouseXY[1]-15+"px")}return{name:"barTooltipSvg",onInit:function(e){t.me=e,this._.options.showBarTooltip=!0},onCreate:function(){n.call(this)},onRefresh:function(){o.call(this)},onResize:function(){(function(){n.call(this),e.style("opacity",0).style("display","none")}).call(this)},visible:function(){return t.visible}}},worldCanvas:function(t){var e={style:{},options:{},drawTo:null,world:null,land:null,lakes:{type:"FeatureCollection",features:[]},countries:{type:"FeatureCollection",features:[]},selected:{type:"FeatureCollection",features:[],multiColor:!1}};function n(){var t=this,n=this._;if(e.world&&((n.options.transparent||n.options.transparentLand)&&this.canvasPlugin.flipRender(function(t,n){t.beginPath(),n(e.land),t.fillStyle=e.style.backLand||"rgba(119,119,119,0.2)",t.fill()},e.drawTo,e.options),n.options.showLand?(n.options.showCountries||e.me.showCountries?o.call(this,n.options.showBorder):function(){this.canvasPlugin.render(function(t,n){t.beginPath(),n(e.land),t.fillStyle=e.style.land||"rgba(2, 20, 37,0.8)",t.fill()},e.drawTo,e.options)}.call(this),!n.drag&&n.options.showLakes&&function(){this.canvasPlugin.render(function(t,n){t.beginPath(),n(e.lakes),t.fillStyle=e.style.lakes||"rgba(80, 87, 97, 0.5)",t.fill()},e.drawTo,e.options)}.call(this)):n.options.showBorder&&o.call(this,!0),this.hoverCanvas&&n.options.showSelectedCountry)){if(e.selected.features.length>0)if(e.selected.multiColor)for(var r=e.selected.features.length,a=r-1,i=function(){var n=e.selected.features[a-r];t.canvasPlugin.render(function(t,e){t.beginPath(),e(n),t.fillStyle=n.color,t.fill()},e.drawTo,e.options)};r--;)i();else this.canvasPlugin.render(function(t,n){t.beginPath(),n(e.selected),t.fillStyle=e.style.selected||"rgba(87, 255, 99, 0.5)",t.fill()},e.drawTo,e.options);var s=this.hoverCanvas.states().country;s&&!e.selected.features.find(function(t){return t.id===s.id})&&this.canvasPlugin.render(function(t,n){t.beginPath(),n(s),t.fillStyle=e.style.hover||"rgba(117, 0, 0, 0.5)",t.fill()},e.drawTo,e.options)}}function o(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.canvasPlugin.render(function(n,o){n.beginPath(),o(e.countries),t||(n.fillStyle=e.style.countries||"rgba(2, 20, 37,0.8)",n.fill()),n.lineWidth=.1,n.strokeStyle=e.style.border||"rgb(239, 237, 234)",n.stroke()},e.drawTo,e.options)}return{name:"worldCanvas",urls:t&&[t],onReady:function(t,n){e.me.data(n)},onInit:function(t){e.me=t;var n=this._.options;n.showLand=!0,n.showLakes=!0,n.showBorder=!1,n.showCountries=!0,n.transparentLand=!1},onCreate:function(){var t=this;if(this.worldJson&&!e.world&&e.me.allData(this.worldJson.allData()),n.call(this),this.hoverCanvas){var o={};o[e.me.name]=function(){t._.options.spin||t._.refresh()},this.hoverCanvas.onCountry(o)}},onRefresh:function(){n.call(this)},countries:function(t){if(!t)return e.countries.features;e.countries.features=t},selectedCountries:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t)return e.selected.features;e.selected.features=t,e.selected={type:"FeatureCollection",features:t,multiColor:n}},data:function(t){if(!t)return e.world;e.world=t,e.land=topojson.feature(t,t.objects.land),e.countries.features=topojson.feature(t,t.objects.countries).features,t.objects.ne_110m_lakes&&(e.lakes.features=topojson.feature(t,t.objects.ne_110m_lakes).features)},allData:function(t){if(!t)return{world:e.world,land:e.land,lakes:e.lakes,countries:e.countries};e.world=t.world,e.land=t.land,e.lakes=t.lakes,e.countries=t.countries},drawTo:function(t){e.drawTo=t},style:function(t){return t&&(e.style=t),e.style},options:function(t){e.options=t}}},centerSvg:function(){var t={focused:null,svgAddCountriesOld:null};function e(t,e){e=e.replace("x","");for(var n=0,o=t.length;n<o;n++)if(t[n].id==e)return t[n]}function n(t){var e=this._,n=d3.interpolate(e.proj.rotate(),[-t[0],-t[1],0]),o=function(t){return e.rotate(n(t))};d3.transition().duration(2500).tween("rotate",function(){return o})}return{name:"centerSvg",onInit:function(e){t.me=e,this._.options.enableCenter=!0},onCreate:function(){(function(){var o=this;this.worldSvg.$countries().on("click",function(){if(o._.options.enableCenter){var r=this.id.replace("x",""),a=e(o.worldSvg.countries(),r);n.call(o,d3.geoCentroid(a)),"function"==typeof t.focused&&t.focused.call(o)}})}).call(this)},go:function(t){var o=e(this.worldSvg.countries(),t),r=d3.geoCentroid(o);n.call(this,r)},focused:function(e){t.focused=e}}},placesSvg:function(t){var e={svg:null,q:null,places:null},n={};function o(){var t=e.me.name;e.svg.selectAll(".points."+t+",.labels."+t).remove(),e.places&&this._.options.showPlaces&&(function(){var t=e.me.name;n.placePoints=e.svg.append("g").attr("class","points "+t).selectAll("path").data(e.places.features).enter().append("path").attr("class","point")}.call(this),function(){var t=e.me.name;n.placeLabels=e.svg.append("g").attr("class","labels "+t).selectAll("text").data(e.places.features).enter().append("text").attr("class","label").text(function(t){return t.properties.name})}.call(this),r.call(this))}function r(){n.placePoints&&(n.placePoints.attr("d",this._.path),function(){var t=this,e=this._.proj.invert(this._.center);n.placeLabels.attr("text-anchor",function(e){var n=t._.proj(e.geometry.coordinates)[0];return n<t._.center[0]-20?"end":n<t._.center[0]+20?"middle":"start"}).attr("transform",function(e){var n=t._.proj(e.geometry.coordinates),o=n[0],r=n[1];return"translate("+(o+(o<t._.center[0]?-5:5))+","+(r-2)+")"}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,e)>1.57?"none":"inline"})}.call(this))}return{name:"placesSvg",urls:t&&[t],onReady:function(t,n){e.places=n},onInit:function(t){e.me=t,e.svg=this._.svg,this._.options.showPlaces=!0},onCreate:function(){o.call(this)},onRefresh:function(){r.call(this)},data:function(t){if(!t)return e.places;e.places=t},selectAll:function(t){return t&&(e.q=t,e.svg=d3.selectAll(t)),e.svg},$placePoints:function(){return n.placePoints},$placeLabels:function(){return n.placeLabels}}},worldSvg:function(t){var e={q:null,svg:null,world:null,land:null,lakes:{type:"FeatureCollection",features:[]},selected:{type:"FeatureCollection",features:[]},countries:{type:"FeatureCollection",features:[]}},n={};function o(){var t=this._;e.world&&(t.options.transparent||t.options.transparentLand?(n.worldBgPath||r(),t.proj.clipAngle(180),n.worldBgPath.attr("d",t.path),t.proj.clipAngle(90)):n.worldBgPath&&(n.worldBgG.remove(),n.worldBgPath=null),t.options.showLand&&(t.options.showCountries?(n.countriesPath||(n.worldG.remove(),n.worldPath=null,i()),n.countriesPath.attr("d",t.path)):(n.worldPath||(n.countriesG.remove(),n.countriesPath=null,a()),n.worldPath.attr("d",t.path)),t.options.showLakes&&n.lakesPath.attr("d",t.path)))}function r(){n.worldBgG=n.g.append("g").attr("class","landbg"),n.worldBgPath=n.worldBgG.append("path").datum(e.land).attr("fill","rgba(119,119,119,0.2)")}function a(){n.worldG=n.g.append("g").attr("class","land"),n.worldPath=n.worldG.append("path").datum(e.land)}function i(){n.countriesG=n.g.append("g").attr("class","countries"),n.countriesPath=n.countriesG.selectAll("path").data(e.countries.features).enter().append("path").attr("class",function(t){return"cid-"+t.properties.cid}).attr("id",function(t){return"x"+t.id})}function s(){n.lakesG=n.g.append("g").attr("class","lakes").append("path").datum(e.lakes),n.lakesPath=n.lakesG.append("path").datum(e.lakes)}return{name:"worldSvg",urls:t&&[t],onReady:function(t,n){e.me.data(n)},onInit:function(t){e.me=t,e.svg=this._.svg;var n=this._.options;n.showLand=!0,n.showLakes=!0,n.showCountries=!0,n.transparentLand=!1,function(){e.svgAddCountries=i,e.svgAddWorldBg=r,e.svgAddLakes=s,e.svgAddWorld=a}.call(this)},onCreate:function(){this.worldJson&&!e.world&&e.me.allData(this.worldJson.allData()),function(){var t=this._,r=e.me.name;e.svg.selectAll(".world."+r).remove(),t.options.showLand&&(n.g=e.svg.append("g").attr("class","world "+r),e.world&&((t.options.transparent||t.options.transparentLand)&&e.svgAddWorldBg.call(this),t.options.showCountries||e.me.showCountries?e.svgAddCountries.call(this):e.svgAddWorld.call(this),!t.drag&&t.options.showLakes&&e.svgAddLakes.call(this)),o.call(this))}.call(this)},onRefresh:function(){o.call(this)},countries:function(t){if(!t)return e.countries.features;e.countries.features=t},data:function(t){if(!t)return e.world;e.world=t,e.land=topojson.feature(t,t.objects.land),e.countries.features=topojson.feature(t,t.objects.countries).features,t.objects.ne_110m_lakes&&(e.lakes.features=topojson.feature(t,t.objects.ne_110m_lakes).features)},allData:function(t){if(!t)return{world:e.world,land:e.land,lakes:e.lakes,countries:e.countries};e.world=t.world,e.land=t.land,e.lakes=t.lakes,e.countries=t.countries},selectAll:function(t){return t&&(e.q=t,e.svg=d3.selectAll(t)),e.svg},$world:function(){return n.worldPath},$lakes:function(){return n.lakesPath},$countries:function(){return n.countriesPath}}},barSvg:function(t){var e={svg:null,barProjection:null,q:null,bars:null,valuePath:null},n={},o=d3.scaleLinear().domain([0,200]).range([5,50]);function r(){var t=this._,r=e.me.name;if(function(){var t=this._;this.$slc.defs.selectAll("clipPath").remove(),this.$slc.defs.append("clipPath").append("circle").attr("id","edgeCircle").attr("cx",t.center[0]).attr("cy",t.center[1]).attr("r",t.proj.scale())}.call(this),e.svg.selectAll(".bar."+r).remove(),e.bars&&t.options.showBars){var i=e.svg.append("g").attr("class","bar "+r),s=i.append("mask").attr("id","edge");s.append("rect").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("fill","white"),s.append("use").attr("xlink:href","#edgeCircle").attr("fill","black"),e.max=d3.max(e.bars.features,function(t){return parseInt(t.geometry.value)});var l=t.proj.scale();e.heightScale=d3.scaleLinear().domain([0,e.max]).range([l,l+o(l)]),n.bar=i.selectAll("line").data(e.bars.features).enter().append("line").attr("stroke","red").attr("stroke-width","2").attr("data-index",function(t,e){return e}),a.call(this)}}function a(){var t=this._;if(e.bars&&t.options.showBars){var o=t.proj,r=e.heightScale,a=e.barProjection,i=o.invert(t.center);a.rotate(this._.proj.rotate()),n.bar.each(function(t){var e=t.geometry.coordinates;a.scale(r(t.geometry.value));var n=d3.geoDistance(e,i),s=o(e),l=a(e);d3.select(this).attr("x1",s[0]).attr("y1",s[1]).attr("x2",l[0]).attr("y2",l[1]).attr("mask",n<1.57?null:"url(#edge)")})}}return{name:"barSvg",urls:t&&[t],onReady:function(t,n){e.me.data(n)},onInit:function(t){e.me=t,function(){var t=this._;t.options.showBars=!0,e.barProjection=t.projection(),e.svg=t.svg}.call(this)},onCreate:function(){r.call(this)},onRefresh:function(){a.call(this)},onResize:function(){r.call(this)},selectAll:function(t){return t&&(e.q=t,e.svg=d3.selectAll(t)),e.svg},valuePath:function(t){e.valuePath=t},data:function(t){var n=this;if(!t)return e.bars;if(e.valuePath){var o=e.valuePath.split(".");t.features.forEach(function(t){var e=t;o.forEach(function(t){return e=e[t]}),t.geometry.value=e})}e.bars=t,setTimeout(function(){return a.call(n)},1)},$bar:function(){return n.bar}}},mapSvg:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".ej-flexbox",n={q:null,svg:null,world:null,land:null,onCountry:{},onCountryVals:[],selectedCountry:null,lakes:{type:"FeatureCollection",features:[]},selected:{type:"FeatureCollection",features:[]},countries:{type:"FeatureCollection",features:[]}},o={};function r(){var t=this,r=n.me.name;n.flexBox=d3.selectAll(e),n.svg.selectAll(".countries."+r).remove(),this._.options.showMap&&(o.g=n.svg.append("g").attr("class","countries "+r),o.countries=o.g.selectAll("path").data(n.countries.features).enter().append("path").attr("class",function(t){return"cid-"+t.properties.cid}).attr("id",function(t){return"x"+t.id}),o.countries.on("click",function(e){var r=this,a=e.properties.cid;if(o.countries.classed("selected",!1),t.choroplethCsv){var i=-1,s=t.choroplethCsv.colorScale(),l=s.scale(e.properties.value);n.selectedCountry&&(i=s.scale(n.selectedCountry.properties.value)),i===l&&n.selectedCountry!==e||t.choroplethCsv.setSelectedColor(l-1),t.choroplethCsv.cid(a),d3.selectAll(".color-countries-item").classed("selected",!1),d3.selectAll(".color-countries-item.cid-"+a).classed("selected",!0)}n.selectedCountry!==e?(n.selectedCountry=e,o.countries.filter("#x"+e.id).classed("selected",!0)):n.selectedCountry=null,n.onCountryVals.forEach(function(t){t.call(r,d3.event,e)})}).on("mouseover",function(t){var e=d3.event,o=e.pageX,r=e.pageY;(n.me.show||function(t,e){var n=t.properties,o=Object.keys(n).map(function(t){return t+": "+n[t]}).join("<br/>");return e.html(o)})(t,n.mapTooltip).style("display","block").style("left",o+7+"px").style("top",r-15+"px"),n.flexBox.style("display","flex")}).on("mouseout",function(t){n.me.hide&&n.me.hide(t,n.mapTooltip),n.mapTooltip.style("display","none"),null===n.selectedCountry&&n.flexBox.style("display","none")}).on("mousemove",function(){var t=d3.event,e=t.pageX,o=t.pageY;n.mapTooltip.style("left",e+7+"px").style("top",o-15+"px")}),a.call(this))}function a(){this._.options.showMap&&o.countries.attr("d",n.path)}return n.mapTooltip=d3.select("body").append("div").attr("class","ej-country-tooltip"),{name:"mapSvg",urls:t&&[t],onReady:function(t,e){n.me.data(e)},onInit:function(t){n.me=t,this._.options.showMap=!0,function(){n.svg=this._.svg;var t=this._.options,e=t.width,r=t.height,a=e/6.279;n.zoom=d3.zoom().on("zoom",function(){return o.g.attr("transform",d3.event.transform)}),n.proj=d3.geoEquirectangular().scale(a).translate([e/2,r/2]),n.path=d3.geoPath().projection(n.proj).context(n.context),n.svg.call(n.zoom)}.call(this)},onCreate:function(){this.worldJson&&!n.world&&n.me.allData(this.worldJson.allData()),r.call(this)},onRefresh:function(){a.call(this)},onCountry:function(t){Object.assign(n.onCountry,t),n.onCountryVals=Object.keys(n.onCountry).map(function(t){return n.onCountry[t]})},selectedCountry:function(){return n.selectedCountry},data:function(t){if(!t)return n.world;n.world=t,n.land=topojson.feature(t,t.objects.land),n.countries.features=topojson.feature(t,t.objects.countries).features,t.objects.ne_110m_lakes&&(n.lakes.features=topojson.feature(t,t.objects.ne_110m_lakes).features)},allData:function(t){if(!t)return{world:n.world,land:n.land,lakes:n.lakes,countries:n.countries};n.world=t.world,n.land=t.land,n.lakes=t.lakes,n.countries=t.countries},selectAll:function(t){return t&&(n.q=t,n.svg=d3.selectAll(t)),n.svg},resetZoom:function(){n.svg.call(n.zoom.transform,d3.zoomIdentity)}}},haloSvg:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#fff",e={svg:null,q:null},n={};var o=d3.scaleLinear().domain([100,300]).range([110,330]);function r(){var t=o(this._.proj.scale());n.halo.attr("rx",t).attr("ry",t)}return{name:"haloSvg",onInit:function(t){e.me=t,function(){var t=this._;t.options.showHalo=!0,e.svg=t.svg}.call(this)},onCreate:function(){(function(){var o=e.me.name;e.svg.selectAll("#halo,.halo."+o).remove(),this._.options.showHalo&&(this.$slc.defs.append("radialGradient").attr("id","halo").attr("cx","50%").attr("cy","50%").html('\n<stop offset="85%" stop-color="'+t+'" stop-opacity="1"></stop>\n<stop offset="100%" stop-color="'+t+'" stop-opacity="0"></stop>\n'),n.halo=e.svg.append("g").attr("class","halo "+o).append("ellipse").attr("class","noclicks").attr("cx",this._.center[0]).attr("cy",this._.center[1]),r.call(this))}).call(this)},onResize:function(){r.call(this)},selectAll:function(t){return t&&(e.q=t,e.svg=d3.selectAll(t)),e.svg},$halo:function(){return n.halo}}},dotsSvg:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).important,n={dataDots:null,radiusPath:null},o={};function r(){var t=this._,r=void 0;if(o.dots&&t.options.showDots){var a=n.dataDots.geometry||{};t.options.transparent||t.options.transparentDots?(t.proj.clipAngle(180),o.dots.style("fill",function(e,n){return r=e.coordinates[0][n],d3.geoDistance(r,t.proj.invert(t.center))>1.57?"none":a.fillStyle||"rgba(100,0,0,.4)"}),o.dots.style("display",function(){return t.drag&&!e?"none":"inline"}),o.dots.attr("d",t.path),t.proj.clipAngle(90)):(o.dots.style("display",function(n,o){return r=n.coordinates[0][o],d3.geoDistance(r,t.proj.invert(t.center))>1.57||t.drag&&!e?"none":"inline"}),o.dots.style("fill",a.fillStyle||"rgba(100,0,0,.4)"),o.dots.attr("d",t.path))}}return{name:"dotsSvg",urls:t&&[t],onReady:function(t,e){n.me.data(e)},onInit:function(t){n.me=t,function(){var t=this._;t.options.showDots=!0,n.svg=t.svg}.call(this)},onCreate:function(){(function(){var t=this._,e=n.me.name;if(n.svg.selectAll(".dot."+e).remove(),n.dataDots&&t.options.showDots){var a=[];if(n.circles.forEach(function(t){a.push(t.circle)}),o.dots=n.svg.append("g").attr("class","dot "+e).selectAll("path").data(a).enter().append("path"),n.dataDots.geometry){var i=n.dataDots.geometry||{};o.dots.style("stroke-width",i.lineWidth||.2).style("fill",i.fillStyle||"rgba(100,0,0,.4)").style("stroke",i.strokeStyle||"rgba(119,119,119,.4)").attr("data-index",function(t,e){return e})}r.call(this)}}).call(this)},onRefresh:function(){r.call(this)},radiusPath:function(t){n.radiusPath=t},data:function(t){var e,o,a=this;if(!t)return n.dataDots;if(n.radiusPath){var i=n.radiusPath.split("."),s=t.features.map(function(t){var e=t;return i.forEach(function(t){return e=e[t]}),e}).sort(),l=d3.scaleLinear().domain([s[0],s.pop()]).range([.5,2]);t.features.forEach(function(t){var e=t;i.forEach(function(t){return e=e[t]}),t.geometry.radius=l(e)})}n.dataDots=t,e=d3.geoCircle(),o=(n.dataDots.geometry||{}).radius||.5,n.circles=n.dataDots.features.map(function(t){var n=t.geometry.coordinates,r=t.properties,a=t.geometry.radius||o;return{properties:r,coordinates:n,circle:e.center(n).radius(a)()}}),setTimeout(function(){return r.call(a)},1)},selectAll:function(t){return t&&(n.q=t,n.svg=d3.selectAll(t)),n.svg},$dots:function(){return o.dots}}},pingsSvg:function(){var t={svg:null,dataPings:null},e={};function n(){var t=e.ping2.nodes().filter(function(t){return"inline"==t.style.display});t.length>0&&d3.select("#"+t[Math.floor(Math.random()*(t.length-1))].id).attr("r",2).attr("stroke","#F00").attr("stroke-opacity",1).attr("stroke-width","10px").transition().duration(1e3).attr("r",30).attr("fill","none").attr("stroke-width","0.1px")}function o(){if(null==this._.drag)e.pings.style("display","none");else if(!this._.drag&&e.pings&&this._.options.showPings){var t=this._.proj,n=this._.proj.invert(this._.center);e.pings.attr("cx",function(e){return t(e.geometry.coordinates)[0]}).attr("cy",function(e){return t(e.geometry.coordinates)[1]}).style("display",function(t){return d3.geoDistance(t.geometry.coordinates,n)>1.57?"none":"inline"})}}return{name:"pingsSvg",onInit:function(e){t.me=e,function(){var e=this,o=this._;o.options.showPings=!0,setInterval(function(){return n.call(e)},3e3),t.svg=o.svg}.call(this)},onCreate:function(){(function(){var r=t.me.name;if(t.svg.selectAll(".pings."+r).remove(),t.dataPings&&this._.options.showPings){var a=t.svg.append("g").attr("class","pings "+r);e.ping2=a.selectAll(".ping-2").data(t.dataPings.features).enter().append("circle").attr("class","ping-2").attr("id",function(t,e){return"ping-"+e}),e.pings=a.selectAll(".ping-2"),o.call(this),n.call(this)}}).call(this)},onRefresh:function(){o.call(this)},data:function(e){if(!e)return t.dataPings;t.dataPings=e},selectAll:function(e){return e&&(t.q=e,t.svg=d3.selectAll(e)),t.svg},$pings:function(){return e.pings}}},pinCanvas:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[15,25],o={dataPin:null,image:null,w:null,h:null};function r(t){this._.options.showPin=!0;var e=this._.proj.scale();o.w=d3.scaleLinear().domain([0,e]).range([0,t[0]]),o.h=d3.scaleLinear().domain([0,e]).range([0,t[1]]),i.call(this)}function a(){if(this._.options.showPin){var t=this._,e=t.proj.invert(t.center);this.canvasPlugin.render(function(n){o.dataPin&&o.dataPin.features.forEach(function(r){var a=r.geometry.coordinates;if(d3.geoDistance(a,e)<=1.57){var i=t.path.centroid(r);n.drawImage(o.image,i[0]-o.pX,i[1]-o.pY,o.wh[0],o.wh[1])}})},o.drawTo)}}function i(){var t=this._.proj.scale(),e=[o.w(t),o.h(t)];o.wh=e,o.pX=e[0]/2,o.pY=e[1]}return d3.select("body").append("img").attr("src",e).attr("id","pin").attr("width","0").attr("height","0"),o.image=document.getElementById("pin"),{name:"pinCanvas",urls:t&&[t],onReady:function(t,e){o.me.data(e)},onInit:function(t){o.me=t,r.call(this,n)},onCreate:function(){var t=this;setTimeout(function(){return a.call(t)},1)},onResize:function(){i.call(this)},onRefresh:function(){a.call(this)},data:function(t){if(!t)return o.dataPin;o.dataPin=t},drawTo:function(t){o.drawTo=t},image:function(){return o.image},size:function(t){if(!t)return o.wh;o.wh=t,r.call(this,t)}}},dotsCanvas:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).important,n={dataDots:null,dots:[],radiusPath:null};function o(){var t=this._;if((!t.drag||e)&&n.dataDots&&this._.options.showDots){var o=this._.proj,r=n.dataDots.geometry||{},a=o.invert(this._.center),i=[],s=[];n.dots.forEach(function(t){d3.geoDistance(t.coordinates,a)>1.57?i.push(t.circle):s.push(t.circle)}),(t.options.transparent||t.options.transparentDots)&&this.canvasPlugin.flipRender(function(t,e){t.beginPath(),e({type:"GeometryCollection",geometries:i}),t.lineWidth=.2,t.strokeStyle="rgba(119,119,119,.4)",t.stroke()},n.drawTo),this.canvasPlugin.render(function(t,e){t.beginPath(),e({type:"GeometryCollection",geometries:s}),t.lineWidth=r.lineWidth||.2,t.fillStyle=r.fillStyle||"rgba(100,0,0,.4)",t.strokeStyle=r.strokeStyle||"rgba(100,0,0,.6)",t.fill(),t.stroke()},n.drawTo)}}return{name:"dotsCanvas",urls:t&&[t],onReady:function(t,e){n.me.data(e)},onInit:function(t){n.me=t,this._.options.transparentDots=!1,this._.options.showDots=!0},onCreate:function(){o.call(this)},onRefresh:function(){(e||!0!==this._.drag)&&o.call(this)},radiusPath:function(t){n.radiusPath=t},data:function(t){var e,r,a=this;if(!t)return n.dataDots;if(n.radiusPath){var i=n.radiusPath.split("."),s=t.features.map(function(t){var e=t;return i.forEach(function(t){return e=e[t]}),e}).sort(),l=d3.scaleLinear().domain([s[0],s.pop()]).range([.5,2]);t.features.forEach(function(t){var e=t;i.forEach(function(t){return e=e[t]}),t.geometry.radius=l(e)})}n.dataDots=t,e=d3.geoCircle(),r=(n.dataDots.geometry||{}).radius||.5,n.dots=n.dataDots.features.map(function(t){var n=t.geometry.coordinates,o=t.properties,a=t.geometry.radius||r;return{properties:o,coordinates:n,circle:e.center(n).radius(a)()}}),setTimeout(function(){return o.call(a)},1)},drawTo:function(t){n.drawTo=t},dots:function(){return n.dots}}},pingsCanvas:function(){var t={dataPings:null,pings:[]},e=0;return{name:"pingsCanvas",onInit:function(e){t.me=e,this._.options.showPings=!0},onInterval:function(n){(function(n){if(n-e>40&&(e=n,!this._.drag&&this._.options.showPings)){var o=void 0,r=this._.proj;if(t.pings.length<=7){o=this._.proj.invert(this._.center);var a=t.dataPings.features.filter(function(t){return d3.geoDistance(t.geometry.coordinates,o)<=1.57}),i=a[Math.floor(Math.random()*(a.length-1))];t.pings.push({r:2.5,l:i.geometry.coordinates})}var s=t.pings[0];d3.geoDistance(s.l,this._.proj.invert(this._.center))>1.57?t.pings.shift():(this._.options.spin||this._.refresh(/anvas/),this.canvasPlugin.render(function(e){if(e.beginPath(),e.fillStyle="#F80",e.arc(r(s.l)[0],r(s.l)[1],s.r,0,2*Math.PI),e.fill(),e.closePath(),s.r=s.r+.2,s.r>5)t.pings.shift();else if(t.pings.length>1){var n=t.pings.shift();t.pings.push(n)}},t.drawTo))}}).call(this,n)},data:function(e){if(!e)return t.dataPings;t.dataPings=e},drawTo:function(e){t.drawTo=e}}},centerCanvas:function(){var t={focused:null};function e(t){var e=this._,n=d3.interpolate(e.proj.rotate(),[-t[0],-t[1],0]),o=function(t){return e.rotate(n(t))};d3.transition().duration(2500).tween("rotate",function(){return o})}return{name:"centerCanvas",onInit:function(e){t.me=e,this._.options.enableCenter=!0},onCreate:function(){(function(){var n=this;this.clickCanvas&&this.clickCanvas.onCountry({centerCanvas:function(o,r){r&&(e.call(n,d3.geoCentroid(r)),"function"==typeof t.focused&&(t.focused.call(n,o,r),n.threejsPlugin&&n.threejsPlugin.rotate()))}})}).call(this)},go:function(t){var n=function(t,e){e=(""+e).replace("x","");for(var n=0,o=t.length;n<o;n++)if(t[n].id==e)return t[n]}(this.worldCanvas.countries(),t),o=d3.geoCentroid(n);this.inertiaPlugin&&this.inertiaPlugin.stopDrag(),e.call(this,o)},focused:function(e){t.focused=e}}},flattenSvg:function(){var t={};function e(){var t=this;return t._.svg.transition().duration(10500).tween("projection",function(){return function(n){e.alpha(n),t._.refresh()}})}function n(n,o){t.px=d3.geoProjection(function(t,e){var a=n([t*=180/Math.PI,e*=180/Math.PI]),i=o([t,e]);return[(1-r)*a[0]+r*i[0],(r-1)*a[1]-r*i[1]]}).scale(1);var r=void 0;return e.alpha=function(e){if(!arguments.length)return r;r=+e;var a=n.center(),i=o.center(),s=n.translate(),l=o.translate();return t.px.center([(1-r)*a[0]+r*i[0],(1-r)*a[1]+r*i[1]]),t.px.translate([(1-r)*s[0]+r*l[0],(1-r)*s[1]+r*l[1]]),t.px},e.alpha(0),t.px}return window._flat=t,{name:"flattenSvg",onInit:function(e){t.me=e,function(){var e=this._.proj,n=d3.geoEquirectangular().scale(this._.options.width/6.3).translate(this._.center);t.g1=e,t.g2=n,t.scale=d3.scaleLinear().domain([47.3,t.g1.scale()]).range([.0559,1]),t.scaleG2=d3.scaleLinear().domain([47.3,t.g1.scale()]).range([0,t.g2.scale()])}.call(this)},onResize:function(){if(this._.options.map){var e=t.g1.scale(),n=t.scale(e);t.px.scale(n),t.path.attr("d",this._.path)}},toMap:function(){var o=this;(function(){var t=this._;return d3.transition().duration(1500).tween("rotate",function(){t.rotate(t.proj.rotate());var e=d3.interpolate(t.proj.rotate(),[0,0,0]);return function(n){t.rotate(e(n))}})}).call(this).on("end",function(){t.g2.scale(t.scaleG2(t.g1.scale()));var r=n(t.g1,t.g2);o._.path=d3.geoPath().projection(r),e.call(o).on("end",function(){t.path=o._.svg.selectAll("path"),o._.options.enableCenter=!1,o._.options.map=!0})})},toGlobe:function(){var o=this;this._.rotate([0,0,0]),t.g2.scale(t.scaleG2(t.g1.scale()));var r=n(t.g2,t.g1);this._.path=d3.geoPath().projection(r),e.call(this).on("end",function(){o._.path=d3.geoPath().projection(t.g1),o._.options.enableCenter=!0,o._.options.map=!1,o._.refresh()})}}},barThreejs:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n={sphereObject:null,data:null},o=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,morphTargets:!1,color:11206655});function r(){var t=this.threejsPlugin;if(!n.sphereObject){var r=new THREE.Group,a=this._.proj.scale();n.max=d3.max(n.data.features,function(t){return parseInt(t.geometry.value)}),n.scale=d3.scaleLinear().domain([0,n.max]).range([2,70]),n.data.features.forEach(function(t){var i=t.geometry.value,s=i?n.scale(i):e,l=function(t){for(var e=new THREE.BoxGeometry(2,2,t),n=0;n<e.faces.length;n+=2){var o=16777215*Math.random();e.faces[n].color.setHex(o),e.faces[n+1].color.setHex(o)}return e}(s),c=new THREE.Mesh(l,o);c.coordinates=t.geometry.coordinates,function(t,e){var n=.017453292519943295*(90-t.coordinates[1]),o=.017453292519943295*(360-t.coordinates[0]);t.position.x=e*Math.sin(n)*Math.cos(o),t.position.y=e*Math.cos(n),t.position.z=e*Math.sin(n)*Math.sin(o),t.lookAt({x:0,y:0,z:0})}(c,s/2+a),c.ov=s,r.add(c)}),n.sphereObject=r,n.sphereObject.name=n.me.name}t.addGroup(n.sphereObject)}return{name:"barThreejs",urls:t&&[t],onReady:function(t,e){n.me.data(e)},onInit:function(t){n.me=t},onCreate:function(){r.call(this)},data:function(t){if(!t)return n.data;if(n.valuePath){var e=n.valuePath.split(".");t.features.forEach(function(t){var n=t;e.forEach(function(t){return n=n[t]}),t.geometry.value=n})}n.data=t},scale:function(t){n.sphereObject.children.forEach(function(e){e.scale.x=t,e.scale.y=t,e.scale.z=t})},sphere:function(){return n.sphereObject},color:function(t){o.color.set(t),o.needsUpdate=!0,this.threejsPlugin.renderThree()}}},hmapThreejs:function(t){var e={sphereObject:null,material:new THREE.MeshBasicMaterial({transparent:!0})},n={canvas:null};return{name:"hmapThreejs",urls:t&&[t],onReady:function(t,n){e.me.data(n)},onInit:function(o){e.me=o,function(){this._.options.showHmap=!0;var o=this._.proj.scale();if(e.geometry=new THREE.SphereGeometry(o,30,30),n.canvas=d3.select("body").append("canvas").style("position","absolute").style("display","none").style("top","450px").attr("id","webgl-hmap"),e.canvas=n.canvas.node(),e.heatmap=createWebGLHeatmap({intensityToAlpha:!0,width:1024,height:512,canvas:e.canvas}),e.texture=new THREE.Texture(e.canvas),e.material.map=e.texture,!t){n.canvas.style("display","inherit");var r=function(t,n){for(var o=0;o<200;){var r=2*Math.random()-1,a=2*Math.random()-1,i=r*r+a*a;if(!(i>1)){var s=Math.sqrt(i);r/=s,a/=s,r*=1-i,a*=1-i,o+=1,e.heatmap.addPoint(t+50*r,n+50*a,30,2/300)}}};e.canvas.addEventListener("touchmove",function(t){t.preventDefault();for(var e=t.changedTouches,n=0;n<e.length;n++){var o=e[n];r(o.pageX,o.pageY)}},!1),e.canvas.onmousemove=function(t){var e=t.offsetX||t.clientX,n=t.offsetY||t.clientY;r(e,n)},e.canvas.onclick=function(){e.heatmap.clear()}}}.call(this)},onInterval:function(){t||(e.texture.needsUpdate=!0)},onCreate:function(){(function(){var t=this.threejsPlugin;e.sphereObject||(e.sphereObject=new THREE.Mesh(e.geometry,e.material),e.sphereObject.name=e.me.name),e.texture.needsUpdate=!0,t.addGroup(e.sphereObject)}).call(this)},onRefresh:function(){(function(){e.heatmap.update(),e.heatmap.display()}).call(this)},data:function(t){if(!t)return e.world;e.world=t,e.countries=topojson.feature(t,t.objects.countries)},sphere:function(){return e.sphereObject}}},dotsThreejs:function(t){var e={dataDots:null,onHover:{},onHoverVals:[]};function n(t){var n=!0,o=!1,r=void 0;try{for(var a,i=e.onHoverVals[Symbol.iterator]();!(n=(a=i.next()).done);n=!0)a.value.call(t.target,t)}catch(t){o=!0,r=t}finally{try{!n&&i.return&&i.return()}finally{if(o)throw r}}}function o(){var t=this,o=this.threejsPlugin;if(!e.sphereObject){var r=this._.proj.scale()+(this.__plugins("3d").length>0?4:0);e.sphereObject=new THREE.Group,e.sphereObject.name=e.me.name,e.dataDots.features.forEach(function(a){var i=function(t,e){var n=this.threejsPlugin,o=new THREE.MeshBasicMaterial({color:t.geometry.color||12687769,side:THREE.DoubleSide,transparent:!0,depthWrite:!1,depthTest:!0,opacity:.5}),r=10*(t.geometry.radius||.5),a=new THREE.CircleBufferGeometry(r,25),i=new THREE.Mesh(a,o),s=n.vertex(t.geometry.coordinates,e);return i.position.set(s.x,s.y,s.z),i.lookAt({x:0,y:0,z:0}),i}.call(t,a,r);i.__data__=a,e.sphereObject.add(i),o.domEvents&&o.domEvents.addEventListener(i,"mousemove",n,!1)})}o.addGroup(e.sphereObject)}return{name:"dotsThreejs",urls:t&&[t],onReady:function(t,n){e.me.data(n)},onInit:function(t){e.me=t},onCreate:function(){o.call(this)},data:function(t){if(!t)return e.dataDots;e.dataDots=t},onHover:function(t){Object.assign(e.onHover,t),e.onHoverVals=Object.keys(e.onHover).map(function(t){return e.onHover[t]})},sphere:function(){return e.sphereObject}}},dotsCThreejs:function(t){var e={dataDots:null};return{name:"dotsCThreejs",urls:t&&[t],onReady:function(t,n){e.me.data(n)},onInit:function(t){e.me=t,function(){var t=void 0,n=this._.options;n.showDots=!0,this.canvasThreejs.onDraw({dotsCThreejs:function(o,r){if(n.showDots){t||(t=e.dots.map(function(t){return t.circle}));var a=e.dataDots.geometry||{};o.beginPath(),r({type:"GeometryCollection",geometries:t}),o.lineWidth=a.lineWidth||.2,o.fillStyle=a.fillStyle||"rgba(100,0,0,.4)",o.strokeStyle=a.strokeStyle||"rgba(100,0,0,.6)",o.fill(),o.stroke()}}})}.call(this)},data:function(t){if(!t)return e.dataDots;var n,o;e.dataDots=t,n=d3.geoCircle(),o=(e.dataDots.geometry||{}).radius||.5,e.dots=e.dataDots.features.map(function(t){var e=t.geometry.coordinates,r=t.properties,a=t.geometry.radius||o;return{properties:r,coordinates:e,circle:n.center(e).radius(a)()}})}}},iconsThreejs:function(t,e){var n={sphereObject:null};function o(){var t=this.threejsPlugin;if(!n.sphereObject){var e=new THREE.Group,o=this._.proj.scale();n.data.features.forEach(function(t){var r=new THREE.PlaneGeometry(1,1,1,1),a=new THREE.Mesh(r,n.material);a.coordinates=t.geometry.coordinates,function(t,e){var n=.017453292519943295*(90-t.coordinates[1]),o=.017453292519943295*(360-t.coordinates[0]);t.position.x=e*Math.sin(n)*Math.cos(o),t.position.y=e*Math.cos(n),t.position.z=e*Math.sin(n)*Math.sin(o),t.lookAt({x:0,y:0,z:0})}(a,o+1),a.scale.set(6,6,1),e.add(a)}),n.sphereObject=e,n.sphereObject.name=n.me.name}t.addGroup(n.sphereObject)}return{name:"iconsThreejs",urls:t&&[t],onReady:function(t,e){n.me.data(e)},onInit:function(t){n.me=t,function(){var t=this.threejsPlugin;this._.options.showIcons=!0,n.material=new THREE.MeshPhongMaterial({side:THREE.DoubleSide,transparent:!0,map:t.texture(e)}),n.data&&!n.loaded&&(o.call(this),t.rotate())}.call(this)},onCreate:function(){(function(){n.material&&!n.loaded&&o.call(this)}).call(this)},data:function(t){if(!t)return n.data;if(n.valuePath){var e=n.valuePath.split(".");t.features.forEach(function(t){var n=t;e.forEach(function(t){return n=n[t]}),t.geometry.value=n})}n.data=t},scale:function(t){n.sphereObject.children.forEach(function(e){e.scale.set(t+2,t+2,1)})},sphere:function(){return n.sphereObject}}},canvasThreejs:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6.279,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2048,o={world:null,sphereObject:null,onHover:{},onHoverVals:[],style:{},onDraw:{},onDrawVals:[],countries:{type:"FeatureCollection",features:[]},selected:{type:"FeatureCollection",features:[]},material:new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,alphaTest:.5})};function r(t){var e=!0,n=!1,r=void 0;try{for(var a,i=o.onHoverVals[Symbol.iterator]();!(e=(a=i.next()).done);e=!0)a.value.call(t.target,t)}catch(t){n=!0,r=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw r}}}var a=d3.scaleLinear().domain([30,450]).range([10,2]);function i(){var t=this._.options;o.style.ocean?(o.context.fillStyle=o.style.ocean,o.context.fillRect(0,0,o.canvas.width,o.canvas.height)):o.context.clearRect(0,0,o.canvas.width,o.canvas.height);var e=t.showBorder;if(o.context.beginPath(),e||function(){if(this._.options.choropleth){for(var t=o.countries.features.length;t--;){var e=o.countries.features[t],n=e.properties.color||o.style.countries||"rgba(2, 20, 37,0.8)";o.context.beginPath(),o.path(e),o.context.fillStyle=n,o.context.strokeStyle=n,o.context.fill(),o.context.stroke()}return!0}return o.path(o.countries),o.context.fillStyle=o.style.countries||"rgba(2, 20, 37,0.8)",o.context.fill(),!1}.call(this),!t.choropleth&&(t.showBorder||void 0===t.showBorder)){var n=a(this._.proj.scale());n<1&&(n=1),e&&o.path(o.allCountries),o.context.lineWidth=n,o.context.strokeStyle=o.style.border||"rgb(239, 237, 234)",o.context.stroke()}o.newContext.drawImage(o.canvas,0,0),o.refresh=!0}function s(){if(o.refresh&&this.hoverCanvas&&this._.options.showSelectedCountry){o.refresh=!1,o.newContext.clearRect(0,0,o.canvas.width,o.canvas.height),o.newContext.drawImage(o.canvas,0,0),o.selected.features.length>0&&(o.newContext.beginPath(),o.path2(o.selected),o.newContext.fillStyle=o.style.selected||"rgba(87, 255, 99, 0.5)",o.newContext.fill());var t=this.hoverCanvas.states().country;t&&!o.selected.features.find(function(e){return e.id===t.id})&&(o.newContext.beginPath(),o.path2(t),o.newContext.fillStyle=o.style.hover||"rgba(117, 0, 0, 0.5)",o.newContext.fill()),o.texture.needsUpdate=!0,this.threejsPlugin.renderThree()}}return{name:"canvasThreejs",urls:t&&[t],onReady:function(t,e){o.me.data(e)},onInit:function(t){o.me=t,function(){var t=this._.proj.scale()+(this.__plugins("3d").length>0?4:0);o.geometry=new THREE.SphereGeometry(t,30,30),o.newCanvas=d3.select("body").append("canvas").style("display","none").attr("class","ej-canvas-new").node(),o.newContext=o.newCanvas.getContext("2d"),o.texture=new THREE.Texture(o.newCanvas),o.texture.transparent=!0,o.material.map=o.texture;var r=2*n;o.canvas=d3.select("body").append("canvas").style("display","none").attr("width",r).attr("height",n).attr("class","ej-canvas-ctx").node(),o.context=o.canvas.getContext("2d"),o.proj=d3.geoEquirectangular().scale(r/e).translate([r/2,n/2]),o.path=d3.geoPath().projection(o.proj).context(o.context),o.path2=d3.geoPath().projection(o.proj).context(o.newContext),o.newCanvas.width=o.canvas.width,o.newCanvas.height=o.canvas.height,o.me._=o}.call(this)},onCreate:function(){this.worldJson&&!o.world&&o.me.data(this.worldJson.data()),function(){var t=this,e=this.threejsPlugin;o.sphereObject||(i.call(this),o.sphereObject=new THREE.Mesh(o.geometry,o.material),o.sphereObject.name=o.me.name,e.domEvents&&e.domEvents.addEventListener(o.sphereObject,"mousemove",r,!1)),o.onDrawVals.forEach(function(e){e.call(t,o.newContext,o.path)}),o.texture.needsUpdate=!0,e.addGroup(o.sphereObject)}.call(this)},onResize:function(){i.call(this)},onRefresh:function(){s.call(this)},onDraw:function(t){Object.assign(o.onDraw,t),o.onDrawVals=Object.keys(o.onDraw).map(function(t){return o.onDraw[t]})},countries:function(t){if(!t)return o.countries.features;o.countries.features=t},selectedCountries:function(t){if(!t)return o.selected.features;o.selected.features=t},data:function(t){if(!t)return o.world;o.world=t,o.allCountries=topojson.feature(t,t.objects.countries),o.countries.features=o.allCountries.features},allData:function(t){if(!t)return{world:o.world,countries:o.countries};o.world=t.world,o.countries=t.countries},style:function(t){return t&&(o.style=t),o.style},reload:function(){i.call(this),s.call(this)},refresh:function(){o.refresh=!0,s.call(this)},onHover:function(t){Object.assign(o.onHover,t),o.onHoverVals=Object.keys(o.onHover).map(function(t){return o.onHover[t]})},sphere:function(){return o.sphereObject}}},pointsThreejs:function(t){var e={dataPoints:null,onHover:{},onHoverVals:[]};function n(t){var n=!0,o=!1,r=void 0;try{for(var a,i=e.onHoverVals[Symbol.iterator]();!(n=(a=i.next()).done);n=!0)a.value.call(t.target,t)}catch(t){o=!0,r=t}finally{try{!n&&i.return&&i.return()}finally{if(o)throw r}}}return{name:"pointsThreejs",urls:t&&[t],onReady:function(t,n){e.me.data(n)},onInit:function(t){e.me=t,function(){this._.options.showPoints=!0}.call(this)},onCreate:function(){(function(){var t=this.threejsPlugin;if(!e.sphereObject){var o=new THREE.Geometry;e.dataPoints.features.forEach(function(e){var n=new THREE.Vector3,r=t.vertex(e.geometry.coordinates);n.x=r.x,n.y=r.y,n.z=r.z,o.vertices.push(n)});var r=new THREE.PointsMaterial({color:16711680,size:30}),a=new THREE.Points(o,r);e.sphereObject=a,e.sphereObject.name=e.me.name,t.domEvents&&t.domEvents.addEventListener(a,"mousemove",n,!1)}t.addGroup(e.sphereObject)}).call(this)},data:function(t){if(!t)return e.dataPoints;e.dataPoints=t},onHover:function(t){Object.assign(e.onHover,t),e.onHoverVals=Object.keys(e.onHover).map(function(t){return e.onHover[t]})},sphere:function(){return e.sphereObject}}},textureThreejs:function(){var t={},e=d3.geoGraticule()(),n=new THREE.MeshBasicMaterial,o=void 0;return{name:"textureThreejs",onInit:function(e){t.me=e,function(){var e=this._,r=e.proj.scale(),a=e.options.width,i=e.options.height;this._.options.showDrawing=!0,o=new THREE.SphereGeometry(r,30,30);var s=d3.select("body").append("canvas");s.attr("height",i).attr("width",a),t.canvas=s.node(),t.context=t.canvas.getContext("2d"),t.texture=new THREE.Texture(t.canvas),t.canvas.width=t.canvas.height=512,t.texture.needsUpdate=!0,n.map=t.texture;var l=d3.geoMercator().scale(a/2/Math.PI).translate([a/2,i/2]).precision(.5);t.path=d3.geoPath(l,t.context)}.call(this)},onCreate:function(){(function(){var r=this._,a=this.threejsPlugin,i=r.options,s=i.width,l=i.height;t.sphereObject||(t.context.fillStyle="white",t.context.fillRect(0,0,s,l),t.context.beginPath(),t.path(e),t.context.lineWidth=.4,t.context.strokeStyle="rgba(119,119,119,0.6)",t.context.stroke(),t.sphereObject=new THREE.Mesh(o,n),t.sphereObject.name=t.me.name,t.texture.needsUpdate=!1),a.addGroup(t.sphereObject)}).call(this)},sphere:function(){return t.sphereObject}}},graticuleThreejs:function(){var t={sphereObject:null};function e(){t.graticule10=function(){var t=1e-6,e=a(-80,80,2.5),n=i(-180,180,2.5),o=a(-90,90,2.5),r=i(-180,180,2.5);function a(e,n,o){var r=d3.range(e,n-t,o).concat(n);return function(t){return r.map(function(e){return[t,e]})}}function i(e,n,o){var r=d3.range(e,n-t,o).concat(n);return function(t){return r.map(function(e){return[e,t]})}}return{type:"MultiLineString",coordinates:d3.range(90*Math.ceil(-2),180,90).map(o).concat(d3.range(360*Math.ceil(-.25),90,360).map(r)).concat(d3.range(10*Math.ceil(-18),180,10).filter(function(e){return Math.abs(e%90)>t}).map(e)).concat(d3.range(10*Math.ceil(-8),80+t,10).filter(function(e){return Math.abs(e%360)>t}).map(n))}}()}return{name:"graticuleThreejs",onInit:function(n){t.me=n,e.call(this)},onCreate:function(){(function(){var e=this.threejsPlugin;if(!t.sphereObject){var n=new THREE.LineBasicMaterial({color:11184810});t.sphereObject=e.wireframe(t.graticule10,n),t.sphereObject.name=t.me.name}e.addGroup(t.sphereObject)}).call(this)},sphere:function(){return t.sphereObject}}},flightLineThreejs:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:150,o={data:[],sphereObject:null,track_lines_object:null,track_points_object:null,lightFlow:!0,linewidth:3,texture:null,maxVal:1,onHover:{},onHoverVals:[]},r=d3.scaleLinear().domain([30,2500]).range([.001,.005]),a=Math.PI/180,i=[d3.rgb("#ff0000"),d3.rgb("#aaffff")],s=1/0,l=-1/0,c=0,u=100,d=.8,h=1,f=[],p=[],v=0;function g(t,e,n){var o=(90-t)*a,r=(360-e)*a;return{x:n*Math.sin(o)*Math.cos(r),y:n*Math.cos(o),z:n*Math.sin(o)*Math.sin(r)}}function m(t,e,n,o,r){var i=Math.sin((n-t)*a/2)*Math.sin((n-t)*a/2)+Math.cos(t*a)*Math.cos(n*a)*Math.sin((o-e)*a/2)*Math.sin((o-e)*a/2);return r*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}function y(t,e,n,o,r){t*=a,e*=a,n*=a,o*=a;var i=2*Math.asin(Math.sqrt(Math.pow(Math.sin((t-n)/2),2)+Math.cos(t)*Math.cos(n)*Math.pow(Math.sin((e-o)/2),2))),s=Math.sin((1-r)*i)/Math.sin(i),l=Math.sin(r*i)/Math.sin(i),c=s*Math.cos(t)*Math.cos(e)+l*Math.cos(n)*Math.cos(o),u=s*Math.cos(t)*Math.sin(e)+l*Math.cos(n)*Math.sin(o),d=s*Math.sin(t)+l*Math.sin(n);return{lat:180*Math.atan2(d,Math.sqrt(Math.pow(c,2)+Math.pow(u,2)))/Math.PI,lng:180*Math.atan2(u,c)/Math.PI}}var w=void 0;function C(t,e,n){var o=f[t],r=parseInt(1e3*e);return void 0===o[r]&&(o[r]=n.getPoint(e)),o[r]}var j=24,b=j-1,E=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,opacity:.4,transparent:!0,depthWrite:!1,depthTest:!0,color:16777215,linewidth:o.linewidth});var _="\n    attribute float size;\n    attribute vec3 customColor;\n    varying vec3 vColor;\n\n    void main() {\n        vColor = customColor;\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n        gl_PointSize = size * ( 300.0 / length( mvPosition.xyz ) );\n        gl_Position = projectionMatrix * mvPosition;\n    }",x="\n    uniform vec3 color;\n    uniform sampler2D texture;\n    uniform float opacity;\n\n    varying vec3 vColor;\n\n    void main() {\n        gl_FragColor = vec4( color * vColor, opacity );\n        gl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );\n    }";function T(){var t={color:{type:"c",value:new THREE.Color(11184810)},texture:{type:"t",value:o.texture},opacity:{type:"f",value:d}};o.shaderMaterial=new THREE.ShaderMaterial({uniforms:t,vertexShader:_,fragmentShader:x,blending:THREE.AdditiveBlending,depthTest:!0,depthWrite:!1,transparent:!0});var e=new THREE.Group;!function(t){for(var e=0;e<o.data.length;++e){var r=o.data[e][0],i=o.data[e][1],d=o.data[e][2],f=o.data[e][3],w=o.data[e][4];if(r!==d||i!==f){for(var C=[],j=Math.random()*n+.05,b=0;b<9;b++){var E=180*b/8,_=t+Math.sin(E*a)*j,x=y(r,i,d,f,b/8),T=g(x.lat,x.lng,_);C.push(new THREE.Vector3(T.x,T.y,T.z))}for(var k=[],P=new THREE.CatmullRomCurve3(C),R=m(r,i,d,f,t),S=0;S<R;S+=u){var D=S/R;k.push(P.getPoint(D))}var H=R/(2*Math.PI)*24901;H<s&&(s=H),H>l&&(l=parseInt(1e3*Math.ceil(H/1e3)),c=l);var O=w?o.color(w):"rgb(255,255,255)",M=600*Math.random()+400,V=M*h,I=parseInt(R/u)+1,A=V*I;v+=I,p.push({spline:P,num_points:I,spd_points:A,arc_distance:R,arc_distance_miles:H,point_positions:k,default_speed:M,value:w,color:O,speed:V})}}}(o.SCALE+1),e.add(window.MeshLineMaterial?function(){for(var t=p.length,e=new THREE.Group,n=r(o.SCALE),a=0;a<t;++a){for(var i=p[a],s=i.spline,l=i.color,c=new Float32Array(3*j),u=new MeshLineMaterial({color:new THREE.Color(l),useMap:!1,opacity:1,lineWidth:n}),d=0;d<=b;++d){var h=3*d,f=s.getPoint(d/b),v=f.x,g=f.y,m=f.z;c[h+0]=v,c[h+1]=g,c[h+2]=m}var y=new MeshLine;y.setGeometry(c),e.add(new THREE.Mesh(y.geometry,u))}return o.track_lines_object=e,o.track_lines_object}.call(this):function(){for(var t=p.length,e=6*t*j,n=new THREE.BufferGeometry,r=new Float32Array(e),a=new Float32Array(e),i=0;i<t;++i)for(var s=i*j,l=p[i],c=l.spline,u=l.color,d=new THREE.Color(u),h=d.r,f=d.g,v=d.b,g=0;g<b;++g){var m=g+1,y=c.getPoint(g/b),w=c.getPoint(m/b);a[C+0]=y.x,a[C+1]=y.y,a[C+2]=y.z,a[C+3]=w.x,a[C+4]=w.y,a[C+5]=w.z;var C=6*(g+s);r[C+0]=h,r[C+1]=f,r[C+2]=v,r[C+3]=h,r[C+4]=f,r[C+5]=v}return n.addAttribute("position",new THREE.BufferAttribute(a,3)),n.addAttribute("color",new THREE.BufferAttribute(r,3)),n.computeBoundingSphere(),o.track_lines_object=new THREE.Line(n,E,THREE.LineSegments),o.track_lines_object}.call(this)),e.add(function(){w=new Float32Array(3*v);for(var t=new Float32Array(3*v),e=new Float32Array(v),n=new Float32Array(v),r=0,a=0;a<p.length;++a){for(var i=p[a],s=i.value,l=i.color,c=i.point_positions,u=new THREE.Color(l),d=u.r,h=u.g,g=u.b,m=o.point(s||1),y=0;y<c.length;++y)w[3*r+0]=0,w[3*r+1]=0,w[3*r+2]=0,t[3*r+0]=d,t[3*r+1]=h,t[3*r+2]=g,e[r]=s||1,n[r]=m,++r;f[a]=[]}var C=new THREE.BufferGeometry;return C.addAttribute("position",new THREE.BufferAttribute(w,3)),C.addAttribute("customColor",new THREE.BufferAttribute(t,3)),C.addAttribute("value",new THREE.BufferAttribute(e,1)),C.addAttribute("size",new THREE.BufferAttribute(n,1)),C.computeBoundingBox(),o.track_points_object=new THREE.Points(C,o.shaderMaterial),o.attr_position=o.track_points_object.geometry.attributes.position,o.track_points_object}.call(this)),e.name="flightLineThreejs",this.threejsPlugin.domEvents&&this.threejsPlugin.domEvents.addEventListener(o.track_lines_object,"mousemove",function(t){var e=!0,n=!1,r=void 0;try{for(var a,i=o.onHoverVals[Symbol.iterator]();!(e=(a=i.next()).done);e=!0)a.value.call(t.target,t)}catch(t){n=!0,r=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw r}}},!1),o.sphereObject=e,o.sphereObject.name=o.me.name,o.loaded=!0}var k=0;function P(t){t-k>30&&(k=t,function(){for(var t=p.length,e=Date.now(),n=0,r=0;r<t;++r){var a=p[r],i=a.speed,s=a.spline,l=a.num_points,d=a.spd_points,h=a.arc_distance;if(a.arc_distance_miles<=c)for(var f=u/h,v=e%i/d,g=0;g<l;g++){var m=C(r,g*f+v,s),y=m.x,j=m.y,b=m.z,E=3*n;w[E+0]=y,w[E+1]=j,w[E+2]=b,n++}else for(var _=0;_<l;_++){var x=3*n;w[x+0]=1/0,w[x+1]=1/0,w[x+2]=1/0,n++}}o.attr_position.needsUpdate=!0}(),this.threejsPlugin.renderThree())}return{name:"flightLineThreejs",urls:t&&[t],onReady:function(t,e){o.me.data(e)},onInit:function(t){o.me=t,function(){o.SCALE=this._.proj.scale()+(this.__plugins("3d").length>0?4:0),o.texture=this.threejsPlugin.texture(e)}.call(this),this._.options.showFlightLine=!0},onResize:function(){(function(){var t=this._.proj.scale(),e=o.resize(t),n=o.sphereObject.children[1].geometry.attributes,a=n.size,i=n.value;a.array=i.array.map(function(t){return o.point(t)*e}),a.needsUpdate=!0,window.MeshLineMaterial&&o.track_lines_object.children.forEach(function(e){e.material.uniforms.lineWidth.value=r(t),e.material.needsUpdate=!0})}).call(this)},onInterval:function(t){!this._.drag&&o.lightFlow&&P.call(this,t)},onCreate:function(){(function(){!o.texture||o.sphereObject||o.loaded||T.call(this),this.threejsPlugin.addGroup(o.sphereObject)}).call(this)},onHover:function(t){Object.assign(o.onHover,t),o.onHoverVals=Object.keys(o.onHover).map(function(t){return o.onHover[t]})},reload:function(){(function(){p=[],f=[],T.call(this);var t=this.threejsPlugin,e=t.group.children,n=e.findIndex(function(t){return"flightLineThreejs"===t.name});t.group.remove(e[n]),t.group.add(o.sphereObject),t.renderThree()}).call(this)},data:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[50,500],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:150,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.8;if(!t)return o.data;if(o.data=t,e){Array.isArray(e)||(e=["#ff0000","#aaffff"]);var l=d3.extent(t.map(function(t){return t[4]}));i=[d3.rgb(e[0]),d3.rgb(e[1])],o.color=d3.scaleLinear().domain(l).interpolate(d3.interpolateHcl).range(i),o.point=d3.scaleLinear().domain(l).range(r),o.maxVal=l[1]}else o.color=function(){return"rgb(255, 255, 255)"},o.point=function(){return 150},o.maxVal=1;n=a,d=s,o.resize=d3.scaleLinear().domain([30,this._.proj.scale()]).range([.1,1])},sphere:function(){return o.sphereObject},pointSize:function(t){var e=o.sphereObject.children[1].geometry.attributes.size;e.array=e.array.map(function(e){return e*t}),e.needsUpdate=!0},lightFlow:function(t){if(void 0===t)return o.lightFlow;o.lightFlow=t}}},oceanThreejs:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:11184810,n={sphereObject:null};return n.material=t?new THREE.MeshPhongMaterial({color:t}):new THREE.MeshNormalMaterial({transparent:!1,wireframe:!1,opacity:.8}),n.material.transparent=!0,{name:"oceanThreejs",onInit:function(t){n.me=t},onCreate:function(){(function(){var o=this.threejsPlugin;if(!n.sphereObject){var r=this._.proj.scale()-(this.__plugins("3d").length>0?5:0),a=new THREE.SphereGeometry(r,30,30);if(t){var i=new THREE.AmbientLight(e),s=new THREE.Mesh(a,n.material);n.sphereObject=new THREE.Group,n.sphereObject.add(i),n.sphereObject.add(s)}else n.sphereObject=new THREE.Mesh(a,n.material);n.sphereObject.name=n.me.name}o.addGroup(n.sphereObject)}).call(this)},sphere:function(){return n.sphereObject}}},imageThreejs:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../globe/world.png",e={sphereObject:null};return{name:"imageThreejs",onInit:function(n){e.me=n,e.transparent=!1,function(){var n=this.threejsPlugin;e.material=new THREE.MeshBasicMaterial({map:n.texture(t),side:THREE.DoubleSide,transparent:!0,alphaTest:.5}),Object.defineProperty(e.me,"transparent",{get:function(){return e.transparent},set:function(t){e.transparent=t,t?(e.material.side=THREE.DoubleSide,e.material.alphaTest=.01):(e.material.side=THREE.FrontSide,e.material.alphaTest=0),e.material.needsUpdate=!0}})}.call(this)},onCreate:function(){(function(){var t=this.threejsPlugin;if(e.sphereObject)t.addGroup(e.sphereObject);else{var n=this._.proj.scale()+(this.__plugins("3d").length>0?4:0),o=new THREE.SphereGeometry(n,30,30);e.sphereObject=new THREE.Mesh(o,e.material),e.sphereObject.name=e.me.name,t.addGroup(e.sphereObject)}}).call(this)},sphere:function(){return e.sphereObject}}},inertiaThreejs:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{zoomScale:[0,5e4]}).zoomScale,e={},n=0,o=0,r=0,a=0,i=!1,s=!1,l=void 0,c=90*Math.PI/180;function u(){s?(n+=r,o+=a,r*=.98,a*=.98,i&&(r*=.6,a*=.6),n<-c&&(n=-c,r*=-.95),n>c&&(n=c,r*=-.95),i||e.rotation.x.toPrecision(5)!==n.toPrecision(5)||e.rotation.y.toPrecision(5)!==o.toPrecision(5)?(e.rotation.x=n,e.rotation.y=o,e.renderThree(!0)):s=!1):e.removeEventQueue(e.me.name,"onTween")}function d(){var t=e.node.getClientRects()[0],n=d3.event.touches?d3.event.touches[0]:d3.event;return[n.clientX-.5*t.width,n.clientY-.5*t.height]}var h=void 0,f=void 0;function p(){i=!0,s=!0,l=null,h=d(),e.removeEventQueue(e.me.name,"onTween")}function v(){i&&(f=h,l=!0,h=d(),a+=(h[0]-f[0])/2*.005235987755982988,r+=(h[1]-f[1])/2*.005235987755982988,n=e.rotation.x,o=e.rotation.y,u.call(e.this))}function g(){i=!1,l&&(l=!1,e.addEventQueue(e.me.name,"onTween"))}return{name:"inertiaThreejs",onInit:function(n){e.me=n,e.this=this,function(){var n=this._.proj.scale(),o=this._,r=o.proj,a=o.options,i=a.width,s=a.height,l=d3.scaleLinear().domain([0,n]).range([0,1]);this._.svg.on("mousedown touchstart",p).on("mousemove touchmove",v).on("mouseup touchend",g),this._.svg.call(d3.zoom().on("zoom",function(){var o=t,a=n*d3.event.transform.k;if(a>=o[0]&&a<=o[1]){var i=l(a);r.scale(a),e.scale.x=i,e.scale.y=i,e.scale.z=i,e.renderThree(!0)}}).scaleExtent([.1,160]).translateExtent([[0,0],[i,s]]).filter(function(){var t=d3.event,e=t.touches;return"wheel"===t.type||e}))}.call(this)},onCreate:function(){(function(){e.tj=this.threejsPlugin,e.node=this._.svg.node(),e.scale=e.tj.group.scale,e.rotation=e.tj.group.rotation,e.renderThree=e.tj.renderThree,e.addEventQueue=this.__addEventQueue,e.removeEventQueue=this.__removeEventQueue}).call(this)},onTween:function(){u.call(this)}}},worldThreejs:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../globe/world.png",e={world:null,land:null,lakes:{type:"FeatureCollection",features:[]},selected:{type:"FeatureCollection",features:[]},countries:{type:"FeatureCollection",features:[]}};return{name:"worldThreejs",urls:t&&[t],onReady:function(t,n){e.me.data(n)},onInit:function(t){e.me=t,this._.options.showLand=!0},onCreate:function(){(function(){var t=this.threejsPlugin;if(!e.sphereObject){var n=topojson.mesh(e.world,e.world.objects.countries),o=new THREE.MeshBasicMaterial({color:7368816}),r=this._.proj.scale()+(this.__plugins("3d").length>0?4:0);e.sphereObject=t.wireframe(n,o,r),e.sphereObject.name=e.me.name}t.addGroup(e.sphereObject)}).call(this)},data:function(t){if(!t)return e.world;e.world=t,e.land=topojson.feature(t,t.objects.land),e.countries.features=topojson.feature(t,t.objects.countries).features,t.objects.ne_110m_lakes&&(e.lakes.features=topojson.feature(t,t.objects.ne_110m_lakes).features)},allData:function(t){if(!t)return{world:e.world,land:e.land,lakes:e.lakes,countries:e.countries};e.world=t.world,e.land=t.land,e.lakes=t.lakes,e.countries=t.countries},sphere:function(){return e.sphereObject}}},globeThreejs:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../globe/world_1.jpg",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"../globe/earth_elevation.jpg",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"../globe/earth_water.png",o={sphereObject:null,onHover:{},onHoverVals:[]};return{name:"globeThreejs",onInit:function(t){o.me=t,function(){this._.options.showGlobe=!0}.call(this)},onCreate:function(){(function(){var r=this.threejsPlugin;if(o.sphereObject)r.addGroup(o.sphereObject);else{var a=this._.proj.scale(),i=r.texture(t),s=r.texture(e),l=r.texture(n),c=new THREE.SphereGeometry(a,30,30),u=new THREE.MeshPhongMaterial({map:i,bumpMap:s,bumpScale:.01,specularMap:l,specular:new THREE.Color("grey")});o.sphereObject=new THREE.Mesh(c,u),o.sphereObject.name=o.me.name,this.threejsPlugin.domEvents&&this.threejsPlugin.domEvents.addEventListener(o.sphereObject,"mousemove",function(t){var e=!0,n=!1,r=void 0;try{for(var a,i=o.onHoverVals[Symbol.iterator]();!(e=(a=i.next()).done);e=!0)a.value.call(t.target,t)}catch(t){n=!0,r=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw r}}},!1);var d=new THREE.AmbientLight(7829367),h=new THREE.DirectionalLight(16777215,.2),f=new THREE.DirectionalLight(16777215,.2);h.position.set(5,3,6),f.position.set(5,3,-6),r.addGroup(d),r.addGroup(h),r.addGroup(f),r.addGroup(o.sphereObject)}}).call(this)},onHover:function(t){Object.assign(o.onHover,t),o.onHoverVals=Object.keys(o.onHover).map(function(t){return o.onHover[t]})},sphere:function(){return o.sphereObject}}},sphereThreejs:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../globe/world.png",e={sphereObject:null},n={earth:{uniforms:{texture:{type:"t",value:null}},vertexShader:["varying vec3 vNormal;","varying vec2 vUv;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","vUv = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D texture;","varying vec3 vNormal;","varying vec2 vUv;","void main() {","vec3 diffuse = texture2D( texture, vUv ).xyz;","float intensity = 1.05 - dot( vNormal, vec3( 0.0, 0.0, 1.0 ) );","vec3 atmosphere = vec3( 1.0, 1.0, 1.0 ) * pow( intensity, 3.0 );","gl_FragColor = vec4( diffuse + atmosphere, 1.0 );","}"].join("\n")},atmosphere:{uniforms:{},vertexShader:["varying vec3 vNormal;","void main() {","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec3 vNormal;","void main() {","float intensity = pow( 0.8 - dot( vNormal, vec3( 0, 0, 1.0 ) ), 12.0 );","gl_FragColor = vec4( 1.0, 1.0, 1.0, 1.0 ) * intensity;","}"].join("\n")}};return{name:"sphereThreejs",onInit:function(t){e.me=t,this._.options.showSphere=!0},onCreate:function(){(function(){var o=this.threejsPlugin;if(e.sphereObject)o.addGroup(e.sphereObject);else{var r=this._.proj.scale(),a=new THREE.SphereGeometry(r,30,30),i=THREE.UniformsUtils.clone(n.earth.uniforms),s=THREE.UniformsUtils.clone(n.atmosphere.uniforms);i.texture.value=o.texture(t);var l=new THREE.Mesh(a,new THREE.ShaderMaterial({uniforms:i,vertexShader:n.earth.vertexShader,fragmentShader:n.earth.fragmentShader})),c=new THREE.Mesh(a,new THREE.ShaderMaterial({uniforms:s,vertexShader:n.atmosphere.vertexShader,fragmentShader:n.atmosphere.fragmentShader,side:THREE.BackSide,blending:THREE.AdditiveBlending,transparent:!0})),u=new THREE.Group;u.add(l),u.add(c),e.sphereObject=u,e.sphereObject.name=e.me.name,o.addGroup(e.sphereObject)}}).call(this)},sphere:function(){return e.sphereObject},imgSrc:function(t){var n=this.threejsPlugin,o=e.me.sphere().children[0].material;o.uniforms.texture.value=n.texture(t),o.needsUpdate=!0}}},world3dThreejs:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../d/world.geometry.json",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"../globe/gold.jpg",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1.57,a={style:{},tween:null,sphereObject:new THREE.Group,onHover:{},onHoverVals:[]},i="\nvarying vec2 vN;\nvoid main() {\nvec4 p = vec4( position, 1. );\nvec3 e = normalize( vec3( modelViewMatrix * p ) );\nvec3 n = normalize( normalMatrix * normal );\nvec3 r = reflect( e, n );\nfloat m = 2. * length( vec3( r.xy, r.z + 1. ) );\nvN = r.xy / m + .5;\ngl_Position = projectionMatrix * modelViewMatrix * p;\n}",s="\nuniform sampler2D sampler;\nuniform vec3 diffuse;\nvarying vec2 vN;\nvoid main() {\nvec4 tex = texture2D( sampler, vN );\ngl_FragColor = tex + vec4( diffuse, 0 ) * 0.5;\n}";function l(t){var e=!0,n=!1,o=void 0;try{for(var r,i=a.onHoverVals[Symbol.iterator]();!(e=(r=i.next()).done);e=!0)r.value.call(t.target,t)}catch(t){n=!0,o=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw o}}}var c=void 0,u=void 0;return{name:"world3dThreejs",urls:t&&[t],onReady:function(t,e){a.me.data(e)},onInit:function(t){a.me=t,function(){var t=this._.proj.scale();this._.options.showWorld=!0,a.sphereObject.rotation.y=r,a.sphereObject.scale.set(t,t,t),a.sphereObject.name=a.me.name}.call(this),Object.defineProperty(t,"tween",{get:function(){return a.tween},set:function(t){a.tween=t}})},onCreate:function(){(function(){var t=a.world,r=this.threejsPlugin,d=this._.options.choropleth;for(var h in a.uniforms={sampler:{type:"t",value:r.texture(e)},diffuse:{type:"c",value:new THREE.Color(a.style.land||"black")}},t){if(d){var f=t[h].properties||{color:a.style.countries},p={type:"c",value:new THREE.Color(f.color||"black")};u=Object.assign({},a.uniforms,{diffuse:p})}else u=a.uniforms;var v=new o(t[h],n);c=new THREE.ShaderMaterial({uniforms:u,vertexShader:i,fragmentShader:s});var g=new THREE.Mesh(v,c);a.sphereObject.add(g),t[h].mesh=g,r.domEvents&&r.domEvents.addEventListener(g,"mousemove",l,!1)}r.addGroup(a.sphereObject)}).call(this)},onTween:function(){a.tween&&a.tween.call(this)},rotate:function(t){a.sphereObject.rotation.y=t},reloadColor:function(){(function(){var t=a.world,e=this._.options.choropleth;for(var n in t)if(e){var o=t[n],r=o.properties;o.mesh.material.uniforms.diffuse.value.set(r.color)}}).call(this)},data:function(t){if(!t)return a.world;a.world=t},onHover:function(t){Object.assign(a.onHover,t),a.onHoverVals=Object.keys(a.onHover).map(function(t){return a.onHover[t]})},sphere:function(){return a.sphereObject},style:function(t){return t&&(a.style=t),a.style},extrude:function(t){for(var e in a.world){var n=a.world[e];n.mesh.geometry=new o(n,t)}}}},world3dThreejs2:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../d/countries.geo.json",e=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9),n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r={group:{},sphereObject:null,material:new THREE.MeshPhongMaterial({color:new THREE.Color(11180339),side:THREE.DoubleSide})};function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=t.vertices.length/2;t.vertices.forEach(function(t,r){var a=e;r>=o&&(a=1+n);var i=.017453292519943295*(90-t.oy),s=.017453292519943295*(360-t.ox);t.x=a*Math.sin(i)*Math.cos(s),t.y=a*Math.cos(i),t.z=a*Math.sin(i)*Math.sin(s)}),t.verticesNeedUpdate=!0,t.computeFaceNormals()}var i=void 0;function s(t,o){var s=t.id,l=[],c=r.group[s];void 0===c&&((c=new THREE.Group).name=s,r.group[s]=c,r.sphereObject.add(c)),o.forEach(function(t){l.push(new THREE.Vector2(t[0],t[1]))});var u=function(t){var o=new THREE.Shape(t),r=new THREE.ExtrudeGeometry(o,{bevelEnabled:!1,amount:16});return r.vertices.forEach(function(t){t.ox=t.x,t.oy=t.y,t.oz=t.z}),a(r,e,n),new THREE.Mesh(r,i)}(l);u.cid=t.properties.cid,c.add(u)}function l(){this.threejsPlugin.addGroup(r.sphereObject),function(){var t=this._.options.choropleth;r.world.features.forEach(function(e){var n=e.geometry.coordinates;i=t?new THREE.MeshPhongMaterial({color:new THREE.Color(e.properties.color||"rgb(2, 20, 37)"),side:THREE.DoubleSide}):r.material,1===n.length?s(e,n[0]):n.forEach(function(t){1==t.length?s(e,t[0]):s(e,t)})})}.call(this)}return{name:"world3dThreejs2",urls:t&&[t],onReady:function(t,e){r.me.data(e)},onInit:function(t){r.me=t,function(){var t=this._.proj.scale();this._.options.showWorld=!0,r.sphereObject=this.threejsPlugin.light3d(),r.sphereObject.rotation.y=o,r.sphereObject.scale.set(t,t,t),r.sphereObject.name=r.me.name}.call(this)},onCreate:function(){l.call(this)},rotate:function(t){r.sphereObject.rotation.y=t},data:function(t){if(!t)return r.world;r.world=t},sphere:function(){return r.sphereObject},group:function(){return r.group},extrude:function(t,e,n){r.group[t]&&r.group[t].children.forEach(function(t){a(t.geometry,e,n)})}}},commonPlugins:function(t){var e={checker:[],ocn:0,spd:10,pan:0,clr:0};function n(t,e,n,o,r,a,i){t.append("br"),t.append("input").attr("id",e).attr("type","range").attr("min",n).attr("max",o).attr("step",r).attr("value",a).on("input",i)}function o(){var t=this,o=this,r=d3.select(".set-options"),a=d3.select(".set-options2");if(r.selectAll("button, input, br").remove(),a.selectAll("button, input, br").remove(),this._.options.showControll){r.selectAll("button").data(e.checker).enter().append("button").text(function(t){return t[1]}).on("click",function(n){return e.buttonClick.call(t,n.join(":"))}),n(a,"pan",0,400,1,e.pan,function(){e.pan=+this.value;for(var t=1;t<i.length;t++)i[t].style.left=e.pan*t+"px"}),n(a,"ocn",0,20,1,e.ocn,function(){e.ocn=this.value,o.oceanSvg.scale(-e.ocn)}),n(a,"spd",10,200,10,e.spd,function(){e.spd=this.value,o.autorotatePlugin.speed(e.spd)});var i=d3.selectAll(".ea-layer").nodes()}}return e.checker=[":Shadow:showDropShadow",":Ocean:showOcean",":Graticule:showGraticule",":Land:showLand",":Country:showCountries",":Lakes:showLakes",":Transparent:transparent",":Canvas:showCanvas",":Spin:spin"].map(function(t){return t.split(":")}),{name:"commonPlugins",onInit:function(n){e.me=n,function(){var n=this,o=this.register,r=earthjs.plugins;o(r.mousePlugin()),o(r.autorotatePlugin()),o(r.dropShadowSvg()),o(r.oceanSvg()),o(r.canvasPlugin()),o(r.graticuleCanvas()),o(r.worldCanvas(t)),this._.options.transparent=!0,this.canvasPlugin.selectAll(".ej-canvas"),this.graticuleCanvas.drawTo([1]),this.worldCanvas.drawTo([0]),e.options=this._.options,e.buttonClick=function(t){var e=t.split(":")[2],o={},r=n._.options;r[e]=!r[e],o[e]=r[e],"transparent"==e?((r.transparentGraticule||r.transparentLand)&&(o.transparent=!1),o.transparentGraticule=!1,o.transparentLand=!1):"showCountries"==e||"showLakes"==e?o.showLand=!0:"transparentGraticule"!=e&&"transparentLand"!=e||(r.transparent&&(o.transparentGraticule=!1,o.transparentLand=!1),o.transparent=!1)}}.call(this),this._.options.showControll=!0},onCreate:function(){o.call(this)},addChecker:function(t){e.checker.push(t),e.options=this._.options(),o.call(this)}}},selectCountryMix:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../d/world-110m.json",e={};return{name:"selectCountryMix",onInit:function(n){e.me=n,function(){var e=this.register(earthjs.plugins.inertiaPlugin()).register(earthjs.plugins.hoverCanvas()).register(earthjs.plugins.clickCanvas()).register(earthjs.plugins.centerCanvas()).register(earthjs.plugins.canvasPlugin()).register(earthjs.plugins.countryCanvas()).register(earthjs.plugins.autorotatePlugin()).register(earthjs.plugins.worldCanvas(t)).register(earthjs.plugins.threejsPlugin());e.canvasPlugin.selectAll(".ej-canvas"),e._.options.showSelectedCountry=!0,e._.options.showBorder=!1,e.worldCanvas.style({countries:"rgba(220,91,52,0.2)"}),e.worldCanvas.ready=function(t,n){e.countryCanvas.data(n),e.worldCanvas.data(n),e.hoverCanvas.data(n),e.clickCanvas.data(n)},e.centerCanvas.focused(function(t,n){if(e.autorotatePlugin.stop(),t.metaKey){var o=e.worldCanvas.selectedCountries().concat(n);e.worldCanvas.selectedCountries(o)}else e.worldCanvas.selectedCountries([n])})}.call(this)},region:function(t,e){var n=this,o=n.worldCanvas.countries().filter(function(e){return t.indexOf(e.id)>-1});n.worldCanvas.selectedCountries(o),n.autorotatePlugin.stop(),e&&n.centerCanvas.go(e)},multiRegion:function(t,e){var n=[],o=this,r=!0,a=!1,i=void 0;try{for(var s,l=function(){var t=s.value,e=o.worldCanvas.countries().filter(function(e){var n=t.countries.indexOf(e.id)>-1;return n&&(e.color=t.color),n});n=n.concat(e)},c=t[Symbol.iterator]();!(r=(s=c.next()).done);r=!0)l()}catch(t){a=!0,i=t}finally{try{!r&&c.return&&c.return()}finally{if(a)throw i}}o.worldCanvas.selectedCountries(n,!0),o.autorotatePlugin.stop(),e&&o.centerCanvas.go(e)}}},selectCountryMix2:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"../d/world-110m.json",e=arguments[1],n={};return{name:"selectCountryMix2",onInit:function(o){n.me=o,function(){var n=this.register(earthjs.plugins.worldJson(t)).register(earthjs.plugins.inertiaPlugin()).register(earthjs.plugins.hoverCanvas()).register(earthjs.plugins.clickCanvas()).register(earthjs.plugins.centerCanvas()).register(earthjs.plugins.countryCanvas()).register(earthjs.plugins.threejsPlugin()).register(earthjs.plugins.autorotatePlugin());e&&n.register(earthjs.plugins.imageThreejs(e)),n.register(earthjs.plugins.canvasThreejs()),n._.options.showSelectedCountry=!0,n._.options.showBorder=!1,n.canvasThreejs.style({countries:"rgba(220,91,52,0.5)"}),n.centerCanvas.focused(function(t,e){if(n.autorotatePlugin.stop(),t.metaKey){var o=n.canvasThreejs.selectedCountries().concat(e);n.canvasThreejs.selectedCountries(o)}else n.canvasThreejs.selectedCountries([e]);n.canvasThreejs.refresh()})}.call(this)},region:function(t,e){var n=this,o=n.canvasThreejs.countries().filter(function(e){return t.indexOf(e.id)>-1});n.canvasThreejs.selectedCountries(o),n.autorotatePlugin.stop(),e&&n.centerCanvas.go(e)},multiRegion:function(t,e){var n=[],o=this,r=!0,a=!1,i=void 0;try{for(var s,l=function(){var t=s.value,e=o.canvasThreejs.countries().filter(function(e){var n=t.countries.indexOf(e.id)>-1;return n&&(e.color=t.color),n});n=n.concat(e)},c=t[Symbol.iterator]();!(r=(s=c.next()).done);r=!0)l()}catch(t){a=!0,i=t}finally{try{!r&&c.return&&c.return()}finally{if(a)throw i}}o.canvasThreejs.selectedCountries(n,!0),o.autorotatePlugin.stop(),e&&o.centerCanvas.go(e)}}}},e}();